<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="ASO" Title="Apptweak" Id="Apptweak" RequireVersion="7.0.0" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Apptweak.xml" HelpUrl="http://seotoolsforexcel.com/apptweak/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity" />

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/apptweak/">
    <Text Id="ApiToken" Title="API Token" Required="true" HelpUrl="http://seotoolsforexcel.com/apptweak/"/>
  </Settings>

  <Resources>
    <Resource Id="Header">
      <HttpSettings>
        <RequestHeaders>
          <Header Name='X-Apptweak-Key'>@Model.ApiToken</Header>
        </RequestHeaders>
      </HttpSettings>
    </Resource>
    <Resource Id="Error">
      <Fail>
        <JsonPath Expr="error" Id="Error"/>
      </Fail>
    </Resource>
  </Resources>

  <RestConnector Id="iOSCountries" Hidden="true">
    <Fetch Url="https://apptweak.io/api/ios"/>
    <Parse>
      <XPath Expr="//*[@@id='misc']//div[1]/table/tbody/tr">
        <XPath Expr="td[2]" Id="Id"/>
        <XPath Expr="td[1]" Id="Country"/>
      </XPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="AndroidCountries" Hidden="true">
    <Fetch Url="https://apptweak.io/api/android"/>
    <Parse>
      <XPath Expr="//*[@@id='misc']//div[1]/table/tbody/tr">
        <XPath Expr="td[2]" Id="Id"/>
        <XPath Expr="td[1]" Id="Country"/>
      </XPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="iOSCategories" Hidden="true">
    <Fetch Url="https://apptweak.io/api/ios"/>
    <Parse>
      <XPath Expr="//*[@@id='misc']//div[3]/table/tbody/tr">
        <XPath Expr="td[2]" Id="Id"/>
        <XPath Expr="td[1]" Id="Category"/>
      </XPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="AndroidCategories" Hidden="true">
    <Fetch Url="https://apptweak.io/api/android"/>
    <Parse>
      <XPath Expr="//*[@@id='misc']//div[2]/table/tbody/tr">
        <XPath Expr="td[2]" Id="Id"/>
        <XPath Expr="td[1]" Id="Category"/>
      </XPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="iOSLanguages" Hidden="true">
    <Parameters>
      <Text Id="Country" Required="true" Debug.DefaultValue="be" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country"/>
    </Parameters>
    <Fetch Url="https://apptweak.io/api/ios"/>
    <Parse>
      <Regex Expr="(?&#x3C;=&#x3C;td\&#x3E;@(Model.Country)\&#x3C;\/td\&#x3E;\r?\n\&#x3C;td\&#x3E;[a-z,\s]*)[a-z]{2}" Group="0" CaseSensitive="True">
				<Regex Expr=".+" Group="0" Id="Id"/>
			</Regex>
    </Parse>
  </RestConnector>

  <RestConnector Id="AndroidLanguages" Hidden="true">
    <Parameters>
      <Text Id="Country" Required="true" Debug.DefaultValue="be" Select.Connector="AndroidCountries" Select.IdField="Id" Select.TitleField="Country"/>
    </Parameters>
    <Fetch Url="https://apptweak.io/api/android"/>
    <Parse>
      <Regex Expr="(?&#x3C;=&#x3C;td\&#x3E;@(Model.Country)\&#x3C;\/td\&#x3E;\r?\n\&#x3C;td\&#x3E;[a-z,\s]*)[a-z]{2}" Group="0" CaseSensitive="True">
				<Regex Expr=".+" Group="0" Id="Id"/>
			</Regex>
    </Parse>
  </RestConnector>

  <RestConnector Id="iOSAppInformation" Title="iOS App Information" HelpUrl="https://apptweak.io/api/ios#get-application">
    <Parameters>
      <Text Id="AppId" Title="App Id" DefaultValue="" Required="true" Debug.DefaultValue="880047117"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/applications/@(Model.AppId).json
				?language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.application_id" Id="Id" Converter="Int" HelpText=""/>
			<JsonPath Expr="content.store_info.title" Id="Title" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.slug" Id="Slug" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.description" Id="Description" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.subtitle" Id="Subtitle" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.promotionalText" Id="PromotionalText" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.price" Id="Price" Converter="String" HelpText=""/>
			<JsonPath Expr="content.developer.id" Id="DeveloperId" Converter="Long" HelpText=""/>
			<JsonPath Expr="content.developer.name" Id="DeveloperName" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.release_date" Id="ReleaseDate" Converter="DateTime" Converter.SourceFormat="yyyy-MM-dd hh:mm:ss UTC" HelpText=""/>
			<JsonPath Expr="content.store_info.size.current.data" Id="Size" Converter="Long" HelpText=""/>
			<JsonPath Expr="content.store_info.features.game_center" Id="GameCenter" Converter="Bool" HelpText=""/>
			<JsonPath Expr="content.store_info.features.passbook" Id="Passbook" Converter="Bool" HelpText=""/>
			<JsonPath Expr="content.store_info.features.in_apps" Id="InApps" Converter="Bool" HelpText=""/>
			<JsonPath Expr="content.store_info.icon" Id="Icon" Converter="String" HelpText=""/>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="AndroidAppInformation" Title="Android App Information" HelpUrl="https://apptweak.io/api/android#get-application">
    <Parameters>
      <Text Id="AppId" Title="App Id" DefaultValue="" Required="true" Debug.DefaultValue="com.facebook.katana"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/android/applications/@(Model.AppId).json
				?language=@(Model.Language)
				&country=@(Model.Country)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.application_id" Id="Id" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.title" Id="Title" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.slug" Id="Slug" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.short_description" Id="ShortDescription" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.description" Id="Description" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.content_rating" Id="ContentRating" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.price" Id="Price" Converter="String" HelpText=""/>
			<JsonPath Expr="content.developer.name" Id="DeveloperName" Converter="String" HelpText=""/>
			<JsonPath Expr="content.developer.email" Id="DeveloperEmail" Converter="String" HelpText=""/>
			<JsonPath Expr="content.developer.website" Id="DeveloperWebsite" Converter="String" HelpText=""/>
			<JsonPath Expr="content.store_info.size.current.data" Id="Size" Converter="Long" HelpText=""/>
			<JsonPath Expr="content.store_info.icon" Id="Icon" Converter="String" HelpText=""/>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="iOSAppReviews" Title="iOS App Reviews" HelpUrl="https://apptweak.io/api/ios#get-application">
    <Parameters>
      <Text Id="AppId" Title="App Id" DefaultValue="" Required="true" Debug.DefaultValue="880047117"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/applications/@(Model.AppId)/reviews.json
				?language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.*">
				<JsonPath Expr="id" Id="Id" Converter="String" HelpText=""/>
				<JsonPath Expr="title" Id="Title" Converter="String" HelpText=""/>
				<JsonPath Expr="body" Id="Body" Converter="String" HelpText=""/>
				<JsonPath Expr="date" Id="Date" Converter="DateTime" HelpText=""/>
				<JsonPath Expr="rating" Id="Rating" Converter="Double" HelpText=""/>
				<JsonPath Expr="vote_count" Id="Votes" Converter="Long" HelpText=""/>
				<JsonPath Expr="vote_sum" Id="VoteSum" Converter="Long" HelpText=""/>
				<JsonPath Expr="body_length" Id="BodyLength" Converter="Long" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="iOSAppRankings" Title="iOS App Rankings" HelpUrl="https://apptweak.io/api/ios#get-application">
    <Parameters>
      <Text Id="AppId" Title="App Id" DefaultValue="" Required="true" Debug.DefaultValue="880047117"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/applications/@(Model.AppId)/rankings.json
				?language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.type" Id="Type" Converter="String" HelpText=""/>
			<JsonPath Expr="content.start_date" Id="StartDate" Converter="DateTime" HelpText=""/>
			<JsonPath Expr="content.end_date" Id="EndDate" Converter="DateTime" HelpText=""/>
      <JsonPath Expr="content.ranks[0].*">
        <JsonPath Expr="." Id="Ranking" Converter="Long" DefaultValue="-"/>
      </JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="iOSAppRatings" Title="iOS App Ratings" HelpUrl="https://apptweak.io/api/ios#get-application">
    <Parameters>
      <Text Id="AppId" Title="App Id" DefaultValue="" Required="true" Debug.DefaultValue="880047117"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/applications/@(Model.AppId)/ratings.json
				?language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.start_date" Id="StartDate" Converter="DateTime" HelpText=""/>
			<JsonPath Expr="content.end_date" Id="EndDate" Converter="DateTime" HelpText=""/>
			<JsonPath Expr="content.ratings.*">
				<JsonPath Expr="1" Id="Rating1" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="2" Id="Rating2" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="3" Id="Rating3" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="4" Id="Rating4" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="5" Id="Rating5" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="total" Id="Total" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="avg" Id="Average" Converter="Double" DefaultValue="-" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="AndroidAppRatings" Title="Android App Ratings" HelpUrl="https://apptweak.io/api/android#get-application">
    <Parameters>
      <Text Id="AppId" Title="App Id" DefaultValue="" Required="true" Debug.DefaultValue="com.rovio.angrybirds"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/android/applications/@(Model.AppId)/ratings.json
				?country=@(Model.Country)
				&language=@(Model.Language)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content">
				<JsonPath Expr="star_count.1" Id="Rating1" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="star_count.2" Id="Rating2" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="star_count.3" Id="Rating3" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="star_count.4" Id="Rating4" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="star_count.5" Id="Rating5" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="count" Id="Total" Converter="Long" DefaultValue="-" HelpText=""/>
				<JsonPath Expr="average" Id="Average" Converter="Double" DefaultValue="-" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="iOSAppTops" Title="iOS App Tops" HelpUrl="https://apptweak.io/api/ios#get-top">
    <Parameters>
      <Text Id="Category" Title="Category (0 = All)" DefaultValue="0" Required="true" Debug.DefaultValue="0" Select.Connector="iOSCategories" Select.IdField="Id" Select.TitleField="Category" HelpText="The ID of the category this rankings object is referring to."/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
      <Select Id="Type" Title="Type" Required="false" DefaultValue="free" HelpText="The kind of chart you want to fetch.">
        <DataSource>
					<Item Id="free" Title="Free"/>
					<Item Id="paid" Title="Paid"/>
					<Item Id="grossing" Title="Grossing"/>
        </DataSource>
      </Select>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/categories/@(Model.Category)/top.json
				?language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
				&type=@(Model.Type)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.*">
				<JsonPath Expr="id" Id="Id" Converter="Int" HelpText=""/>
				<JsonPath Expr="title" Id="Title" Converter="String" HelpText=""/>
				<JsonPath Expr="slug" Id="Slug" Converter="String" HelpText=""/>
				<JsonPath Expr="developer" Id="Developer" Converter="String" HelpText=""/>
				<JsonPath Expr="price" Id="Price" Converter="String" HelpText=""/>
				<JsonPath Expr="rating" Id="Rating" Converter="Double" HelpText=""/>
				<JsonPath Expr="in_apps" Id="InApps" Converter="Bool" HelpText=""/>
				<JsonPath Expr="icon" Id="Icon" Converter="String" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="AndroidAppTops" Title="Android App Tops" HelpUrl="https://apptweak.io/api/android#get-top">
    <Parameters>
      <Text Id="Category" Title="Category" DefaultValue="ALL" Required="true" Debug.DefaultValue="BUSINESS" Select.Connector="AndroidCategories" Select.IdField="Id" Select.TitleField="Category" HelpText="The ID of the category this rankings object is referring to."/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/android/categories/@(Model.Category)/top.json
				?language=@(Model.Language)
				&country=@(Model.Country)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.*">
				<JsonPath Expr="id" Id="Id" Converter="Int" HelpText=""/>
				<JsonPath Expr="title" Id="Title" Converter="String" HelpText=""/>
				<JsonPath Expr="developer" Id="Developer" Converter="String" HelpText=""/>
				<JsonPath Expr="price" Id="Price" Converter="String" HelpText=""/>
				<JsonPath Expr="rating" Id="Rating" Converter="Double" HelpText=""/>
				<JsonPath Expr="icon" Id="Icon" Converter="String" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="iOSAppSearch" Title="iOS App Search" HelpUrl="https://apptweak.io/api/ios#search-and-top">
    <Parameters>
      <Text Id="Query" Title="Search Term" DefaultValue="" Required="true" Debug.DefaultValue="angry"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
      <Number Id="Results" Title="Results" DefaultValue="10" Minimum="1" Maximum="50" Required="false" HelpText="The number of results for which details should be provided"/>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/searches.json?term=@Utils.UrlEncode(Model.Query)
				?language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
				&num=@(Model.Results)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.*">
				<JsonPath Expr="id" Id="Id" Converter="Int" HelpText=""/>
				<JsonPath Expr="title" Id="Title" Converter="String" HelpText=""/>
				<JsonPath Expr="slug" Id="Slug" Converter="String" HelpText=""/>
				<JsonPath Expr="developer" Id="Developer" Converter="String" HelpText=""/>
				<JsonPath Expr="price" Id="Price" Converter="String" HelpText=""/>
				<JsonPath Expr="rating" Id="Rating" Converter="Double" HelpText=""/>
				<JsonPath Expr="in_apps" Id="InApps" Converter="Bool" HelpText=""/>
				<JsonPath Expr="icon" Id="Icon" Converter="String" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="AndroidAppSearch" Title="Android App Search" HelpUrl="https://apptweak.io/api/android#search-and-top">
    <Parameters>
      <Text Id="Query" Title="Search Term" DefaultValue="" Required="true" Debug.DefaultValue="angry"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/android/searches.json?term=@Utils.UrlEncode(Model.Query)
				?language=@(Model.Language)
				&country=@(Model.Country)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="content.*">
				<JsonPath Expr="id" Id="Id" Converter="Int" HelpText=""/>
				<JsonPath Expr="title" Id="Title" Converter="String" HelpText=""/>
				<JsonPath Expr="developer" Id="Developer" Converter="String" HelpText=""/>
				<JsonPath Expr="price" Id="Price" Converter="String" HelpText=""/>
				<JsonPath Expr="rating" Id="Rating" Converter="Double" HelpText=""/>
				<JsonPath Expr="icon" Id="Icon" Converter="String" HelpText=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="iOSKeywordStats" Title="iOS Keyword Stats" HelpUrl="https://apptweak.io/api/ios#keywords-stats">
    <Parameters>
      <Text Id="Keywords" Title="Keywords" DefaultValue="" Required="true" Debug.DefaultValue="arcade" Multiline="true" HelpText="List of up to 10 keywords you wish to fetch stats on. One keyword per line"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="iOSLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
      <Select Id="Device" Title="Device" Required="false" DefaultValue="iphone" HelpText="The device you want to fetch the application for.">
        <DataSource>
					<Item Id="iphone" Title="iPhone"/>
					<Item Id="ipad" Title="iPad"/>
        </DataSource>
      </Select>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/ios/keywords/stats.json?keywords=@FetchKeywords()
				&language=@(Model.Language)
				&country=@(Model.Country)
				&device=@(Model.Device)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="keys($.content)">
        <JsonPath Expr="key" Id="Keyword" Converter="String"/>
			</JsonPath>
      <JsonPath Expr="$.content.*">
        <JsonPath Expr="competition" Id="Competition"  Converter="Double"/>
        <JsonPath Expr="volume" Id="Volume"  Converter="Double"/>
        <JsonPath Expr="kei" Id="Kei"  Converter="Double"/>
        <JsonPath Expr="competition_details.total_size" Id="CompetitionSize"  Converter="Double"/>
        <JsonPath Expr="volume_details.language_frequency" Id="LanguageFrequency" Converter="Double" DefaultValue=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RestConnector Id="AndroidKeywordStats" Title="Android Keyword Stats" HelpUrl="https://apptweak.io/api/android#keywords-stats">
    <Parameters>
      <Text Id="Keywords" Title="Keywords" DefaultValue="" Required="true" Debug.DefaultValue="arcade" Multiline="true" HelpText="List of up to 10 keywords you wish to fetch stats on. One keyword per line"/>
      <Text Id="Country" Title="Country" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidCountries" Select.IdField="Id" Select.TitleField="Country" HelpText="The two letter country code you want to fetch the application in."/>
      <Text Id="Language" Title="Language (Two-letter Code)" DefaultValue="" Required="true" Debug.DefaultValue="us" Select.Connector="AndroidLanguages" Select.IdField="Id" Select.TitleField="Id" HelpText="The two letter language you want to fetch the application in."/>
    </Parameters>
    <Fetch>
      <Resource Id="Header"/>
      <Fetch.Url>
        <![CDATA[
        https://api.apptweak.com/android/keywords/stats.json?keywords=@FetchKeywords()
				&language=@(Model.Language)
				&country=@(Model.Country)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="keys($.content)">
        <JsonPath Expr="key" Id="Keyword" Converter="String"/>
			</JsonPath>
      <JsonPath Expr="$.content.*">
        <JsonPath Expr="competition" Id="Competition"  Converter="Double"/>
        <JsonPath Expr="volume" Id="Volume"  Converter="Double"/>
        <JsonPath Expr="kei" Id="Kei"  Converter="Double"/>
        <JsonPath Expr="competition_details.total_size" Id="CompetitionSize"  Converter="Double"/>
        <JsonPath Expr="volume_details.language_frequency" Id="LanguageFrequency" Converter="Double" DefaultValue=""/>
			</JsonPath>
    </Parse>
    <Resource Id="Error"/>
  </RestConnector>

  <RazorFunctions>
    <![CDATA[
    string FetchKeywords()
    {
      string[] lines = ((string)Model.Keywords).Trim().Split('\n').Select(e => e.Trim()).Where(e => !string.IsNullOrEmpty(e)).Take(10).ToArray();
      return string.Join(",",lines.Select((e, i) => Utils.UrlEncode(e)).ToArray());
    }
    ]]>
  </RazorFunctions>

</Suite>
