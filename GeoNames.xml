<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="GeoNames" Id="GeoNames" RequireVersion="8.2" Category="GEO" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/GeoNames.xml" HelpUrl="http://seotoolsforexcel.com/geonames/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/geonames/">
    <Text Id="Username" Title="Username" Required="true" HelpUrl="http://seotoolsforexcel.com/geonames/"/>
  </Settings>

	<Resources>
    <Resource Id="Fail">
			<Fail>
				<JsonPath Expr="status.message"/>
			</Fail>
    </Resource>
  </Resources>

  <RestConnector Id="SearchPlaces" Title="Search for Places" HelpUrl="http://www.geonames.org/export/geonames-search.html">
    <Parameters>
      <Text Id="Query" Title="Query" Required="true" Debug.DefaultValue="jönköping" HelpText="Search place name, country name, continent etc."/>
      <Select Id="Country" Title="Filter by Country" DefaultValue="all">
        <DataSource>
					<Item Id="all" Title="All"/>
          <ISOCountryCodes/>
        </DataSource>
      </Select>
		 <Select Id="SearchMode" Title="Search Mode" DefaultValue="name">
        <DataSource>
          <Item Id="name" Title="Name only"/>
          <Item Id="name_equals" Title="Exact name"/>
          <Item Id="name_starts" Title="Nam starts With"/>
					<Item Id="query" Title="Search all attributes"/>
        </DataSource>
      </Select>
      <Number Id="Fuzzy" DefaultValue="1" Increment="0.1" Maximum="1" Format="P0" HelpText="Lower percentage means broader search"/>
      <Select Id="Order" Title="Order by" DefaultValue="relevance">
        <DataSource>
          <Item Id="relevance" Title="Relevance"/>
          <Item Id="population" Title="Population"/>
          <Item Id="elevation" Title="Elevation"/>
        </DataSource>
      </Select>
		</Parameters>
    <Paging PageSize="100" EvenPages="false">
      <Parse>
        <JsonPath Id="AvaliableRows" Expr="totalResultsCount"/>
      </Parse>
    </Paging>
  <Fetch>
    <Fetch.Url>
      <![CDATA[
      http://api.geonames.org/searchJSON?username=@(Model.Username)
			&@(Model.SearchMode)=@(Utils.UrlEncode(Model.Query))
      &fuzzy=@(Model.Fuzzy)
			@(Model.Country != "all" ? "country=" + Model.Country : "")
      &orderby=@(Model.Order)
      &maxRows=@(Model.PageCursor.PageSize)
      &startRow=@(Model.PageCursor.NextSkip)
      ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="geonames[*]">
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="Localized name, the preferred name in the optional language parameter."/>
        <JsonPath Expr="fcodeName" Id="Type" Title="Type" Converter="String" HelpText="The classification of the location."/>
        <JsonPath Expr="adminName1" Id="Region" Title="Region" Converter="String" HelpText="Region of location."/>
        <JsonPath Expr="countryName" Id="CountryName" Title="Country Name" Converter="String" HelpText="Country Name which the location belongs to."/>
        <JsonPath Expr="countryCode" Id="CountryCode" Title="Country Code" Converter="String" HelpText="Country Code which the location belongs to."/>
        <JsonPath Expr="population" Id="Population" Title="Population" Converter="Long" HelpText="Population of the location."/>
        <JsonPath Expr="toponymName" Id="ToponymName" Title="Toponym Name" Converter="String" HelpText="main name of the toponym as displayed on the google maps interface page."/>
        <JsonPath Expr="lat" Id="Latitude" Title="Latitude" Converter="Double" HelpText="Latitude of location."/>
        <JsonPath Expr="lng" Id="Longitude" Title="Longitude" Converter="Double" HelpText="Longitude of location."/>
      </JsonPath>
    </Parse>
		<Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="ReverseLookup" Title="Reverse Lookup" HelpUrl="http://www.geonames.org/export/web-services.html#findNearby">
    <Parameters>
      <Text Id="Latitude" Title="Latitude" Debug.DefaultValue="59.33587"/>
      <Text Id="Longitude" Title="Longitude" Debug.DefaultValue="18.06816"/>
		</Parameters>
  <Fetch>
    <Fetch.Url>
      <![CDATA[
			http://api.geonames.org/findNearbyJSON?lat=@(Model.Latitude)&lng=@(Model.Longitude)&username=@(Model.Username)
      ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="geonames[*]">
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="Localized name, the preferred name in the optional language parameter."/>
        <JsonPath Expr="fcodeName" Id="Type" Title="Type" Converter="String" HelpText="The classification of the location." DefaultValue=""/>
        <JsonPath Expr="adminName1" Id="Region" Title="Region" Converter="String" HelpText="Region of location." DefaultValue=""/>
        <JsonPath Expr="countryName" Id="CountryName" Title="Country Name" Converter="String" HelpText="Country Name which the location belongs to." DefaultValue=""/>
        <JsonPath Expr="countryCode" Id="CountryCode" Title="Country Code" Converter="String" HelpText="Country Code which the location belongs to." DefaultValue=""/>
        <JsonPath Expr="population" Id="Population" Title="Population" Converter="Long" HelpText="Population of the location." DefaultValue=""/>
        <JsonPath Expr="toponymName" Id="ToponymName" Title="Toponym Name" Converter="String" HelpText="main name of the toponym as displayed on the google maps interface page." DefaultValue=""/>
        <JsonPath Expr="lat" Id="Latitude" Title="Latitude" Converter="Double" HelpText="Latitude of location."/>
        <JsonPath Expr="lng" Id="Longitude" Title="Longitude" Converter="Double" HelpText="Longitude of location."/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="NearbyWikiArticles" Title="Nearby Wikipedia articles" HelpUrl="http://www.geonames.org/export/wikipedia-webservice.html#findNearbyWikipedia">
    <Parameters>
      <Text Id="Latitude" Title="Latitude" Debug.DefaultValue="59.33587"/>
      <Text Id="Longitude" Title="Longitude" Debug.DefaultValue="18.06816"/>
      <Number Id="Results" Title="Number of Results" Minimum="1" DefaultValue="1"/>
		</Parameters>
  <Fetch>
    <Fetch.Url>
      <![CDATA[
			http://api.geonames.org/findNearbyWikipediaJSON?lat=@(Model.Latitude)&lng=@(Model.Longitude)&username=@(Model.Username)&maxRows=@(Model.Results)
      ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="geonames[*]">
        <JsonPath Expr="wikipediaUrl" Id="Url" Title="URL" Converter="String" HelpText=""/>
        <JsonPath Expr="title" Id="Title" Title="Title" Converter="String" HelpText="" DefaultValue=""/>
        <JsonPath Expr="summary" Id="Summary" Title="Summary" Converter="String" HelpText="" DefaultValue=""/>
        <JsonPath Expr="feature" Id="Feature" Title="Feature" Converter="String" HelpText="" DefaultValue=""/>
        <JsonPath Expr="rank" Id="Rank" Title="Rank" Converter="Int" HelpText="" DefaultValue=""/>
        <JsonPath Expr="distance" Id="Distance" Title="Distance" Converter="Double" HelpText=""/>
        <JsonPath Expr="lat" Id="Latitude" Title="Latitude" Converter="Double" HelpText="Latitude of location."/>
        <JsonPath Expr="lng" Id="Longitude" Title="Longitude" Converter="Double" HelpText="Longitude of location."/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="TimeZoneLookup" Title="Timezone Lookup" HelpUrl="http://www.geonames.org/export/web-services.html#timezone">
    <Parameters>
      <Text Id="Latitude" Title="Latitude" Debug.DefaultValue="59.33587"/>
      <Text Id="Longitude" Title="Longitude" Debug.DefaultValue="18.06816"/>
		</Parameters>
  <Fetch>
    <Fetch.Url>
      <![CDATA[
			http://api.geonames.org/timezoneJSON?lat=@(Model.Latitude)&lng=@(Model.Longitude)&username=@(Model.Username)
      ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
			<JsonPath Expr="time" Id="Time" Title="Time" Converter="DateTime" HelpText=""/>
			<JsonPath Expr="timezoneId" Id="TimezoneId" Title="Timezone" Converter="String" HelpText="" DefaultValue=""/>
			<JsonPath Expr="rawOffse" Id="RawOffset" Title="Offset Raw" Converter="Double" HelpText="" DefaultValue=""/>
			<JsonPath Expr="gmtOffset" Id="GMTOffset" Title="Offset GMT" Converter="Double" HelpText="" DefaultValue=""/>
			<JsonPath Expr="dstOffset" Id="DMTOffset" Title="Offset DMT" Converter="Double" HelpText="" DefaultValue=""/>
			<JsonPath Expr="sunrise" Id="Sunrise" Title="Sunrise" Converter="DateTime" HelpText=""/>
			<JsonPath Expr="sunset" Id="Sunset" Title="Sunset" Converter="DateTime" HelpText=""/>
			<JsonPath Expr="lat" Id="Latitude" Title="Latitude" Converter="Double" HelpText="Latitude of location."/>
			<JsonPath Expr="lng" Id="Longitude" Title="Longitude" Converter="Double" HelpText="Longitude of location."/>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

</Suite>
