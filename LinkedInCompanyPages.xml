<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="Social" RequireVersion="7.0.0" Title="LinkedIn Page Insights" Id="LinkedInPageInsights" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/LinkedInPageInsights.xml" HelpUrl="http://seotoolsforexcel.com/linkedinpageinsights/" HelpText="Documentation">

  <Author Name="Victor" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/DeepCrawl/">
    <Text Id="AccessToken" Title="Access Token" Required="true" HelpUrl="http://seotoolsforexcel.com/linkedinpageinsights/"/>
  </Settings>
  
  <Resources>
    <Resource Id="Languages">
      <Item Id="all" Title="All Languages"/>
    </Resource>
  </Resources>

  <RestConnector Id="CompanyPages" Title="Company Pages">
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://api.linkedin.com/v1/companies?format=json&is-company-admin=true
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="values[*]">
        <JsonPath Expr="id" Id="Id" Converter="String"/>
        <JsonPath Expr="name" Id="name" Title="Name" Converter="String"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="UserSearch" Title="Users Search">
    <Parameters>
      <Text Id="Query" Title="Search" Debug.DefaultValue="flowers" Required="true"/>
      <Select Id="Language" Title="Language" Required="false" DefaultValue="all">
        <DataSource>
          <Resource Id="Languages"/>
        </DataSource>
      </Select>
    </Parameters>
    <Paging PageSize="50" EvenPages="false">
      <Parse>
        <JsonPath Id="NextToken" Expr="nextPageToken"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/plus/v1/people?
        query=@Utils.UrlEncode(Model.Query)
        @if(Model.Language != "all")
        {
          @: &language=@(Model.Language)
        }
        &maxResults=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0)
        {
          @: &pageToken=@(Model.NextToken)
        }
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="items[*]">
        <JsonPath Expr="id" Id="Id" Title="User Id" Converter="String"/>
        <JsonPath Expr="url" Id="UserUrl" Title="User URL" Converter="String"/>
        <JsonPath Expr="displayName" Id="DisplayName" Title="Display Name" Converter="String"/>
        <JsonPath Expr="objectType" Id="ObjectType" Title="Type" Converter="String"/>
        <JsonPath Expr="image.url" Id="Thumbnail" Converter="String"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="ActivityURLtoId" Title="Activity URL to Id">
    <Parameters>
      <Text Id="ActivityUrl" Title="Activitiy URL" Debug.DefaultValue="https://plus.google.com/111820758890749788846/posts/ctdtveW6CmK" Required="true"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        @(Model.ActivityUrl)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <Regex Expr="data-uid=&quot;(\w*)&quot;" Id="ActivityId" Group="1" Converter="String"/>
    </Parse>
  </RestConnector>

  <RestConnector Id="ActivityLookup" Title="Activity Lookup">
    <Parameters>
      <Text Id="Id" Title="Activity Id" Debug.DefaultValue="z13xvpixcrjnsbylq23ozndwjsrssxnqw04" Required="true"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/plus/v1/activities/
        @Utils.UrlEncode(Model.Id)
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="id" Id="Id" Converter="String"/>
      <JsonPath Expr="url" Id="Url" Title="URL" Converter="String"/>
      <JsonPath Expr="published" Id="Published" Converter="Datetime"/>
      <JsonPath Expr="title" Id="Title" Converter="String"/>
      <Compute Id="Content" Title="Content">
        <Compute.Expr>
          <![CDATA[
          @{
            var tt = Model.ContentInput;
            var tt2 = Regex.Replace(tt,"http", " http");
            var Cleaned = Regex.Replace(tt2, "<.*?>", String.Empty);
          }
          @Cleaned
          ]]>
        </Compute.Expr>
      <JsonPath Expr="object.content" Id="ContentInput" Converter="String"/>
      </Compute>
      <JsonPath Expr="object.objectType" Id="Type" Converter="String"/>
      <JsonPath Expr="object.replies.totalItems" Id="Replies" Converter="Int"/>
      <JsonPath Expr="object.plusoners.totalItems" Id="PlusOners" Converter="Int"/>
      <JsonPath Expr="object.resharers.totalItems" Id="Reshares" Converter="Int"/>
      <JsonPath Expr="object.attachments[0].objectType" Id="AttachmentType" Title="Attachment Type" Converter="String" DefaultValue=""/>
      <JsonPath Expr="object.attachments[0].url" Id="AttachmentUrl" Title="Attachment URL" Converter="String" DefaultValue=""/>
      <JsonPath Expr="updated" Id="Updated" Converter="Datetime"/>
      <JsonPath Expr="actor.id" Id="UserId" Title="User Id" Converter="String"/>
      <JsonPath Expr="actor.displayName" Id="DisplayName" Title="Display Name" Converter="String"/>
      <JsonPath Expr="actor.url" Id="UserUrl" Title="User URL" Converter="String"/>
      <JsonPath Expr="actor.image.url" Id="AvatarUrl" Title="Avatar URL" Converter="String"/>
    </Parse>
  </RestConnector>

  <RestConnector Id="UserLookup" Title="User Lookup">
    <Parameters>
      <Text Id="Id" Title="User Id" Debug.DefaultValue="101547009692517311652" Required="true"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/plus/v1/people/
        @(Model.Id)
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
        <IntervalBetweenRequests RandomFrom="100" RandomTo="200" IfSame="Host"/>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="id" Id="Id" Converter="String"/>
      <JsonPath Expr="url" Id="UserUrl" Title="User Url" Converter="String"/>
      <JsonPath Expr="displayName" Id="DisplayName" Title="Display Name" Converter="String"/>
      <JsonPath Expr="name.familyName" Id="FamilyName" Title="Family Name" Converter="String"/>
      <JsonPath Expr="name.givenName" Id="GivenName" Title="Given Name" Converter="String"/>
      <JsonPath Expr="gender" Id="gender" Title="Gender" Converter="String"/>
      <JsonPath Expr="circledByCount" Id="CircledByCount" Title="Followers" Converter="Int"/>
      <JsonPath Expr="objectType" Id="ObjectType" Title="Type" Converter="String"/>
      <JsonPath Expr="isPlusUser" Id="IsPlusUser" Title="Plus User" Converter="Bool"/>
      <JsonPath Expr="image.url" Id="Thumbnail" Converter="String"/>
    </Parse>
  </RestConnector>

  <RestConnector Id="UserActivities" Title="User Activities">
    <Parameters>
      <Text Id="Id" Title="User Id" Debug.DefaultValue="101547009692517311652" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false">
      <Parse>
        <JsonPath Id="NextToken" Expr="nextPageToken"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/plus/v1/people/
        @Utils.UrlEncode(Model.Id)
        /activities/public?
        &maxResults=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0)
        {
          @: &pageToken=@(Model.NextToken)
        }
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="items[*]">
        <JsonPath Expr="id" Id="PostId" Title="Post Id" Converter="String"/>
        <JsonPath Expr="url" Id="Url" Title="URL" Converter="String"/>
        <JsonPath Expr="published" Id="Published" Converter="Datetime"/>
        <JsonPath Expr="title" Id="Title" Converter="String"/>
        <Compute Id="Content" Title="Content">
          <Compute.Expr>
            <![CDATA[
            @{
              var tt = Model.ContentInput;
              var tt2 = Regex.Replace(tt,"http", " http");
              var Cleaned = Regex.Replace(tt2, "<.*?>", String.Empty);
            }
            @Cleaned
            ]]>
          </Compute.Expr>
        <JsonPath Expr="object.content" Id="ContentInput" Converter="String"/>
        </Compute>
        <JsonPath Expr="object.objectType" Id="Type" Converter="String"/>
        <JsonPath Expr="object.replies.totalItems" Id="Replies" Converter="Int"/>
        <JsonPath Expr="object.plusoners.totalItems" Id="PlusOners" Converter="Int"/>
        <JsonPath Expr="object.resharers.totalItems" Id="Reshares" Converter="Int"/>
        <JsonPath Expr="updated" Id="Updated" Converter="Datetime"/>
        <JsonPath Expr="object.attachments[0].objectType" Id="AttachmentType" Title="Attachment Type" Converter="String"/>
        <JsonPath Expr="object.attachments[0].displayName" Id="AttachmentName" Title="Attachment Name" Converter="String" DefaultValue=""/>
        <JsonPath Expr="object.attachments[0].url" Id="AttachmentUrl" Title="Attachment URL" Converter="String" DefaultValue=""/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="ActivityPlusOnersResharers" Title="Activity PlusOners &amp; Resharers">
    <Parameters>
      <Text Id="Id" Title="Activity Id" Debug.DefaultValue="z13txndgskq0cea0ktu4gxzbmtruvvkc1" Required="true"/>
      <Radio Id="Collection" Title="Collection" DefaultValue="plusoners" Required="true">
        <DataSource>
          <Item Id="plusoners" Title="PlusOners"/>
          <Item Id="resharers" Title="Reshares"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Paging PageSize="20" EvenPages="false">
      <Parse>
        <JsonPath Id="NextToken" Expr="nextPageToken"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/plus/v1/activities/
        @Utils.UrlEncode(Model.Id)
        /people/@(Model.Collection)
        ?maxResults=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0)
        {
          @: &pageToken=@(Model.NextToken)
        }
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="items[*]">
        <JsonPath Expr="id" Id="Id" Title="User Id" Converter="String"/>
        <JsonPath Expr="url" Id="UserUrl" Title="User URL" Converter="String"/>
        <JsonPath Expr="displayName" Id="DisplayName" Title="Display Name" Converter="String"/>
        <JsonPath Expr="image.url" Id="Thumbnail" Converter="String"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="ActivityComments" Title="Activity Comments">
    <Parameters>
      <Text Id="Id" Title="Activity Id" Debug.DefaultValue="z12butx4jk3rzph4f04chlah3wjjhzjw4b0" Required="true"/>
      <Radio Id="Sorting" Title="Sorting" DefaultValue="descending" Required="true">
        <DataSource>
          <Item Id="descending" Title="Date Descending"/>
          <Item Id="ascending" Title="Date Ascending"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Paging PageSize="20" EvenPages="false">
      <Parse>
        <JsonPath Id="NextToken" Expr="nextPageToken"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/plus/v1/activities/
        @Utils.UrlEncode(Model.Id)
        /comments
        ?maxResults=@(Model.PageCursor.NextTake)
        @if(Model.PageCursor.Page != 0)
        {
          @: &pageToken=@(Model.NextToken)
        }
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.AccessToken)]]></Header>
        </RequestHeaders>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="items[*]">
        <JsonPath Expr="id" Id="Id" Title="Comment Id" Converter="String"/>
        <JsonPath Expr="object.content" Id="Comment" Title="Comment" Converter="String"/>
        <JsonPath Expr="plusoners.totalItems" Id="PlusOners" Title="PLusoners" Converter="Int"/>
        <JsonPath Expr="published" Id="Published" Title="Published" Converter="DateTime"/>
        <JsonPath Expr="updated" Id="Updated" Title="Updated" Converter="DateTime"/>
        <JsonPath Expr="selfLink" Id="CommentUrl" Title="Comment URL" Converter="String"/>
        <JsonPath Expr="actor.id" Id="UserId" Title="User Id" Converter="String"/>
        <JsonPath Expr="actor.displayName" Id="UserName" Title="User Name" Converter="String"/>
        <JsonPath Expr="actor.url" Id="UserUrl" Title="User URL" Converter="String"/>
        <JsonPath Expr="actor.image.url" Id="UserAvatar" Title="User Avatar" Converter="String"/>
      </JsonPath>
    </Parse>
  </RestConnector>

</Suite>