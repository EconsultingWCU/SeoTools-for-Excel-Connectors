<?xml version="1.0" encoding="utf-8" ?>
<Suite RequireVersion="8.1.20" Title="Google Custom Search" Id="GoogleCustomSearch" Category="SEO" SubCategory="Google" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/GoogleCustomSearch.xml" HelpUrl="http://seotoolsforexcel.com/google-custom-search/" HelpText="Documentation">

  <Author Name="Victor" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/google-custom-search/">
    <Text Id="APIKey" Title="API Key" Required="true"/>
    <Text Id="EngineId" Title="Custom Seach Engine Id" Required="true"/>
  </Settings>

  <RestConnector Id="GoogleCustomSearch" Title="Google Custom Search" HelpUrl="https://developers.google.com/custom-search/json-api/v1/reference/cse/list">
    <Parameters>
      <Text Id="Query" Title="Query" Debug.DefaultValue="seo" Required="true"/>
      <Text Id="Exclude" Title="Exclude Terms" Required="false"/>
      <Text Id="ContainsLink" Title="Contains Link To" Required="false"/>
      <Select Id="Country" Title="Country" Required="false" DefaultValue="all">
        <DataSource>
					<Item Id="all" Title="All"/>
          <ISOCountryCodes/>
        </DataSource>
      </Select>
    </Parameters>
    <Paging PageSize="10">
      <Parse>
        <JsonPath Id="AvaliableRows" Expr="$.queries.request..totalResults"/>
      </Parse>
    </Paging>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://www.googleapis.com/customsearch/v1?key=@(Model.APIKey)
				&cx=@(Model.EngineId)
				&q=@Utils.UrlEncode(Model.Query)
				@(Model.Country != "all" ? "&cr=country" + Model.Country.ToUpper() : "")
        @(!string.IsNullOrEmpty(Model.Exclude) ? "&excludeTerms=" + Utils.UrlEncode(Model.Exclude) : "")
				@(!string.IsNullOrEmpty(Model.ContainsLink) ? "&linkSite=" + Utils.UrlEncode(Model.ContainsLink) : "")
				&num=@(Model.PageCursor.NextTake)
				&start=@(Model.PageCursor.NextSkip+1)
				]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.items[*]">
        <JsonPath Expr="link" Id="Link" Title="Link" Converter="String"/>
        <JsonPath Expr="displayLink" Id="DisplayLink" Title="Display Link" Converter="String"/>
        <JsonPath Expr="title" Id="Title" Title="Title" Converter="String"/>
        <JsonPath Expr="snippet" Id="Snippet" Title="Snippet" Converter="String"/>
        <JsonPath Expr="pagemap.metatags[0]" Id="Metatags" Title="Meta Tags" Converter="String"/>
      </JsonPath>
    </Parse>
  </RestConnector>

</Suite>