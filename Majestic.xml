<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="Majestic" Id="Majestic" RequireVersion="6.1" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Majestic.xml" HelpUrl="http://seotoolsforexcel.com/Majestic/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity" />

  <Settings HelpText="Whats this?" HelpUrl="http://seotoolsforexcel.com/">
    <Text Id="ApiToken" Title="API Token" Required="true" HelpUrl="http://seotoolsforexcel.com/"/>
  </Settings>
	
  <Resources>
    <Resource Id="OrderAnchors">
      <Item Id="anchor" Title="Anchor"/>
      <Item Id="backlinks" Title="Backlinks"/>
      <Item Id="refpages" Title="Refpages"/>
      <Item Id="refdomains" Title="Refdomains"/>
      <Item Id="first_seen" Title="First Seen"/>
      <Item Id="last_visited" Title="Last Visited"/>
    </Resource>
  </Resources>

  <RestConnector Id="IndexData" Title="Index Data" HelpUrl="https://developer-support.majestic.com/api/commands/get-index-item-info.shtml">
    <Parameters>
      <Text Id="Urls" Title="URL(s)" DefaultValue="seotoolsforexcel.com" Required="true" HelpText="Enter one or more URLs separated by a new line" Multiline="true"/>
      <Radio Id="Datasource" Title="Datasource" DefaultValue="fresh" Required="false">
        <DataSource>
          <Item Id="fresh" Title="Fresh"/>
          <Item Id="historic" Title="Historic"/>
        </DataSource>
      </Radio>
    </Parameters>		
    <Fetch>
      <Fetch.Url>
        <![CDATA[
					https://api.majestic.com/api/json?app_api_key=@(Model.ApiToken)
					&cmd=GetIndexItemInfo
					&@FetchUrls()
					&datasource=@(Model.Datasource)
				]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="DataTables.Results.Data[*]">
        <JsonPath Expr="Item" Id="Item" Title="Item" Converter="String" HelpText=""/>
        <JsonPath Expr="CitationFlow" Id="CitationFlow" Title="CitationFlow" Converter="Int" HelpText=""/>
        <JsonPath Expr="TrustFlow" Id="TrustFlow" Title="TrustFlow" Converter="Int" HelpText=""/>
        <JsonPath Expr="TrustMetric" Id="TrustMetric" Title="TrustMetric" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ExtBackLinks" Id="ExtBackLinks" Title="ExtBackLinks" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ExtBackLinksEDU" Id="ExtBackLinksEDU" Title="ExtBackLinksEDU" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ExtBackLinksEDU_Exact" Id="ExtBackLinksEDU_Exact" Title="ExtBackLinksEDU_Exact" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ExtBackLinksGOV" Id="ExtBackLinksGOV" Title="ExtBackLinksGOV" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ExtBackLinksGOV_Exact" Id="ExtBackLinksGOV_Exact" Title="ExtBackLinksGOV_Exact" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="IndexedURLs" Id="IndexedURLs" Title="IndexedURLs" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefDomains" Id="RefDomains" Title="RefDomains" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefDomainsEDU" Id="RefDomainsEDU" Title="RefDomainsEDU" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefDomainsEDU_Exact" Id="RefDomainsEDU_Exact" Title="RefDomainsEDU_Exact" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefDomainsGOV" Id="RefDomainsGOV" Title="RefDomainsGOV" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefDomainsGOV_Exact" Id="RefDomainsGOV_Exact" Title="RefDomainsGOV_Exact" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefIPs" Id="RefIPs" Title="RefIPs" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RefSubNets" Id="RefSubNets" Title="RefSubNets" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="CrawledFlag" Id="CrawledFlag" Title="CrawledFlag" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="FinalRedirectResult" Id="FinalRedirectResult" Title="FinalRedirectResult" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="LastCrawlDate" Id="LastCrawlDate" Title="LastCrawlDate" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="LastCrawlResult" Id="LastCrawlResult" Title="LastCrawlResult" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="OutDomainsExternal" Id="OutDomainsExternal" Title="OutDomainsExternal" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="OutLinksExternal" Id="OutLinksExternal" Title="OutLinksExternal" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="RedirectFlag" Id="RedirectFlag" Title="RedirectFlag" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="RedirectTo" Id="RedirectTo" Title="RedirectTo" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="ResultCode" Id="ResultCode" Title="ResultCode" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="Status" Id="Status" Title="Status" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="Title" Id="Title" Title="Title" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TopicalTrustFlow_Topic_0" Id="TopicalTrustFlow_Topic_0" Title="TopicalTrustFlow_Topic_0" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TopicalTrustFlow_Value_0" Id="TopicalTrustFlow_Value_0" Title="TopicalTrustFlow_Value_0" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TopicalTrustFlow_Topic_1" Id="TopicalTrustFlow_Topic_1" Title="TopicalTrustFlow_Topic_1" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TopicalTrustFlow_Value_1" Id="TopicalTrustFlow_Value_1" Title="TopicalTrustFlow_Value_1" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TopicalTrustFlow_Topic_2" Id="TopicalTrustFlow_Topic_2" Title="TopicalTrustFlow_Topic_2" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TopicalTrustFlow_Value_2" Id="TopicalTrustFlow_Value_2" Title="TopicalTrustFlow_Value_2" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="ACRank" Id="ACRank" Title="ACRank" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="AnalysisResUnitsCost" Id="AnalysisResUnitsCost" Title="AnalysisResUnitsCost" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="DownloadBacklinksAnalysisResUnitsCost" Id="DownloadBacklinksAnalysisResUnitsCost" Title="DownloadBacklinksAnalysisResUnitsCost" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="DownloadRefDomainBacklinksAnalysisResUnitsCost" Id="DownloadRefDomainBacklinksAnalysisResUnitsCost" Title="DownloadRefDomainBacklinksAnalysisResUnitsCost" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="GetTopBackLinksAnalysisResUnitsCost" Id="GetTopBackLinksAnalysisResUnitsCost" Title="GetTopBackLinksAnalysisResUnitsCost" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ItemNum" Id="ItemNum" Title="ItemNum" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText="" Checked="false"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="ErrorMessage"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="BackLinks" Title="BackLinks" HelpUrl="https://developer-support.majestic.com/api/commands/get-back-link-data.shtml">
    <Parameters>
      <Text Id="Url" Title="URL" DefaultValue="seotoolsforexcel.com" Required="true" HelpText="URL/Domain/Subdomain to query"/>
      <Radio Id="Datasource" Title="Datasource" DefaultValue="fresh" Required="false">
        <DataSource>
          <Item Id="fresh" Title="Fresh"/>
          <Item Id="historic" Title="Historic"/>
        </DataSource>
      </Radio>
      <Radio Id="MaxDomains" Title="Max best URLs from any refdomain" DefaultValue="-1" Required="false" HelpText="If set to 1, then it will effectively produce list of referring domains with just 1 best backlink from each of them.">
        <DataSource>
          <Item Id="-1" Title="All"/>
          <Item Id="1" Title="1"/>
          <Item Id="3" Title="3"/>
          <Item Id="10" Title="10"/>
        </DataSource>
      </Radio>			
      <Text Id="MaxUrls" Title="Max same source URLs" DefaultValue="" Required="false" HelpText="If set to greater than 0, then it will set a limit to number of same source urls returned."/>
      <Text Id="FilterTopic" Title="Filter by Topic" DefaultValue="" Required="false" HelpText="For example: Computers/Programming/Languages"/>			
			<Text Id="MaxResults" Title="MaxResults" DefaultValue="20" Required="true" HelpText="Number o of results to be returned back"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
					https://api.majestic.com/api/json?app_api_key=@(Model.ApiToken)
					&cmd=GetBackLinkData
					&item=@(Model.Url)
					&Count=@(Model.MaxResults)
					&datasource=@(Model.Datasource)
					@if(Model.MaxDomains != "-1")
					{
						@: &MaxSourceURLsPerRefDomain=@(Model.MaxDomains)
					}
					@if(Model.MaxUrls != "")
					{
						@: &MaxSameSourceURLs=@(Model.MaxUrls)
					}
					@if(Model.FilterTopic != "")
					{
						@: &FilterTopic=@(Model.FilterTopic)
					}					
				]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="DataTables.BackLinks.Data[*]">
        <JsonPath Expr="SourceURL" Id="SourceURL" Title="SourceURL" Converter="String" HelpText=""/>
        <JsonPath Expr="TargetURL" Id="TargetURL" Title="TargetURL" Converter="String" HelpText=""/>
        <JsonPath Expr="AnchorText" Id="AnchorText" Title="AnchorText" Converter="String" HelpText=""/>
        <JsonPath Expr="Date" Id="Date" Title="Date" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="DateLost" Id="DateLost" Title="DateLost" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="FirstIndexedDate" Id="FirstIndexedDate" Title="FirstIndexedDate" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagAltText" Id="FlagAltText" Title="FlagAltText" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagDeleted" Id="FlagDeleted" Title="FlagDeleted" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagFrame" Id="FlagFrame" Title="FlagFrame" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagImages" Id="FlagImages" Title="FlagImages" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagMention" Id="FlagMention" Title="FlagMention" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagNoFollow" Id="FlagNoFollow" Title="FlagNoFollow" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="FlagRedirect" Id="FlagRedirect" Title="FlagRedirect" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="LastSeenDate" Id="LastSeenDate" Title="LastSeenDate" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="LinkType" Id="LinkType" Title="LinkType" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="LinkSubType" Id="LinkSubType" Title="LinkSubType" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="ReasonLost" Id="ReasonLost" Title="ReasonLost" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="SourceCitationFlow" Id="SourceCitationFlow" Title="SourceCitationFlow" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="SourceTrustFlow" Id="SourceTrustFlow" Title="SourceTrustFlow" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="TargetCitationFlow" Id="TargetCitationFlow" Title="TargetCitationFlow" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="TargetTrustFlow" Id="TargetTrustFlow" Title="TargetTrustFlow" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="TargetTopicalTrustFlow_Topic_0" Id="TargetTopicalTrustFlow_Topic_0" Title="TargetTopicalTrustFlow_Topic_0" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="TargetTopicalTrustFlow_Value_0" Id="TargetTopicalTrustFlow_Value_0" Title="TargetTopicalTrustFlow_Value_0" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="SourceTopicalTrustFlow_Topic_0" Id="SourceTopicalTrustFlow_Topic_0" Title="SourceTopicalTrustFlow_Topic_0" Converter="String" HelpText="" Checked="false"/>
        <JsonPath Expr="SourceTopicalTrustFlow_Value_0" Id="SourceTopicalTrustFlow_Value_0" Title="SourceTopicalTrustFlow_Value_0" Converter="Int" HelpText="" Checked="false"/>
        <JsonPath Expr="ACRank" Id="ACRank" Title="ACRank" Converter="Int" HelpText="" Checked="false"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="ErrorMessage"/>
    </Fail>
  </RestConnector>	


  <RazorFunctions>
		<![CDATA[
		string FetchUrls()
		{
			string[] lines = ((string)Model.Urls).Trim().Split('\n').Select(e => e.Trim()).Where(e => !string.IsNullOrEmpty(e)).Take(100).ToArray();
			return "items=" + lines.Length + "&" + string.Join("&",lines.Select((e, i) => "item" + i + "=" + Utils.UrlEncode(e)).ToArray());
		}
		]]>
	</RazorFunctions>	
</Suite>
