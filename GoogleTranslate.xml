<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="Language" RequireVersion="8.1.2" Title="Google Translate" Id="GoogleTranslate" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/GoogleTranslate.xml" HelpUrl="http://seotoolsforexcel.com/google-translate/" HelpText="Documentation">

  <Author Name="Victor" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/google-translate/">
    <Text Id="APIKey" Title="API Key Id" Required="true" HelpUrl="http://seotoolsforexcel.com/google-translate/"/>
  </Settings>

  <Resources>
    <Resource Id="Fail">
			<Fail>
				<JsonPath Expr="error.message"/>
			</Fail>
    </Resource>
  </Resources>

  <RestConnector Id="Languages" Hidden="true" HelpUrl="https://cloud.google.com/translate/docs/reference/languages">
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://translation.googleapis.com/language/translate/v2/languages?key=@(Model.APIKey)
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestMethod>POST</RequestMethod>
        <RequestContentType>application/json; charset=utf-8</RequestContentType>
        <RequestBody>
					<![CDATA[
						@{
							var dict = new Dictionary<string, string>();
							dict.Add("target", "en");
							var output = Newtonsoft.Json.JsonConvert.SerializeObject(dict);
						}
						@output
					]]>
				</RequestBody>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data.languages[*]">
        <JsonPath Expr="language" Id="Language" Converter="String"/>
        <JsonPath Expr="name" Id="Name" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Detect" Title="Detect" HelpUrl="https://cloud.google.com/translate/docs/reference/detect">
    <Parameters>
      <Text Id="Text" Title="Text" Debug.DefaultValue="Ich würde wirklich gern Ihr Auto" Required="true" HelpText="Enter one or more Texts separated by a new line"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://translation.googleapis.com/language/translate/v2/detect?key=@(Model.APIKey)
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestMethod>POST</RequestMethod>
        <RequestContentType>application/json; charset=utf-8</RequestContentType>
        <RequestBody>
					<![CDATA[
					{"q" : "@(FormatData())"}
					]]>
				</RequestBody>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data.detections[*].*">
				<Compute Id="Language" Title="Language" Converter="String">
					<Compute.Expr>
						<![CDATA[
						@GetLanguage()
						]]>
					</Compute.Expr>
					<JsonPath Expr="language" Id="LanguageInput"/>
				</Compute>
        <JsonPath Expr="confidence" Id="Confidence" Converter="Double"/>
				<JsonPath Expr="language" Id="LanguageShort" Title="Lang Shortcode" Converter="String" Checked="false"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Translate" Title="Translate" HelpUrl="https://cloud.google.com/translate/docs/reference/translate">
    <Parameters>
      <Text Id="Text" Title="Text" Debug.DefaultValue="&quot;Trafikverket och NCC har hävt avtalet i samförstånd.…" Required="true" HelpText="Enter one or more Texts separated by a new line"/>
			<Text Id="Target" Title="Target" Debug.DefaultValue="en" Required="true" Select.Connector="Languages" Select.IdField="Language" Select.TitleField="Name"/>
			<Text Id="Source" Title="Source (Optional)" DefaultValue="" HelpText="Returns 'Detected Language' if omitted" Required="false" Select.Connector="Languages" Select.IdField="Language" Select.TitleField="Name"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        https://translation.googleapis.com/language/translate/v2?key=@(Model.APIKey)&target=@(Model.Target)
				@(!string.IsNullOrEmpty(Model.Source) ? "&source=" + Model.Source : "")
        ]]>
      </Fetch.Url>
      <HttpSettings>
        <RequestMethod>POST</RequestMethod>
        <RequestContentType>application/json; charset=utf-8</RequestContentType>
        <RequestBody>
					<![CDATA[
					{"q" : "@(FormatData())"}
					]]>
				</RequestBody>
      </HttpSettings>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data.translations[*]">
        <Compute Id="Result" Converter="String" DefaultValue="">
          <Compute.Expr>
            <![CDATA[
						@Utils.HtmlDecode(Model.Inp)
						]]>
          </Compute.Expr>
					<JsonPath Expr="translatedText" Id="Inp" DefaultValue=""/>
        </Compute>
				<Compute Id="Language" Title="Language">
					<Compute.Expr>
						<![CDATA[
						@GetLanguage()
						]]>
					</Compute.Expr>
					<JsonPath Expr="detectedSourceLanguage" Id="LanguageInput"/>
				</Compute>
				<JsonPath Expr="detectedSourceLanguage" Id="DetectedLanguageShort" Title="Detected Lang Shortcode" Checked="false"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RazorFunctions>
    <![CDATA[
			string FormatData(){
				string temp1 = Regex.Replace(Model.Text, "\"", "\\\"");
				return Regex.Replace(temp1, "<.*?>", String.Empty);
			}

			string GetLanguage() {
				var dictLangs = new Dictionary<string, string>()
				{
					{"af", "Afrikaans"},
					{"sq", "Albanian"},
					{"am", "Amharic"},
					{"ar", "Arabic"},
					{"hy", "Armenian"},
					{"az", "Azerbaijani"},
					{"eu", "Basque"},
					{"be", "Belarusian"},
					{"bn", "Bengali"},
					{"bs", "Bosnian"},
					{"bg", "Bulgarian"},
					{"ca", "Catalan"},
					{"ceb", "Cebuano"},
					{"ny", "Chichewa"},
					{"zh-CN", "Chinese (Simplified)"},
					{"zh", "Chinese (Simplified)"},
					{"zh-TW", "Chinese (Traditional)"},
					{"co", "Corsican"},
					{"hr", "Croatian"},
					{"cs", "Czech"},
					{"da", "Danish"},
					{"nl", "Dutch"},
					{"en", "English"},
					{"eo", "Esperanto"},
					{"et", "Estonian"},
					{"tl", "Filipino"},
					{"fi", "Finnish"},
					{"fr", "French"},
					{"fy", "Frisian"},
					{"gl", "Galician"},
					{"ka", "Georgian"},
					{"de", "German"},
					{"el", "Greek"},
					{"gu", "Gujarati"},
					{"ht", "Haitian Creole"},
					{"ha", "Hausa"},
					{"haw", "Hawaiian"},
					{"iw", "Hebrew"},
					{"hi", "Hindi"},
					{"hmn", "Hmong"},
					{"hu", "Hungarian"},
					{"is", "Icelandic"},
					{"ig", "Igbo"},
					{"id", "Indonesian"},
					{"ga", "Irish"},
					{"it", "Italian"},
					{"ja", "Japanese"},
					{"jw", "Javanese"},
					{"kn", "Kannada"},
					{"kk", "Kazakh"},
					{"km", "Khmer"},
					{"ko", "Korean"},
					{"ku", "Kurdish (Kurmanji)"},
					{"ky", "Kyrgyz"},
					{"lo", "Lao"},
					{"la", "Latin"},
					{"lv", "Latvian"},
					{"lt", "Lithuanian"},
					{"lb", "Luxembourgish"},
					{"mk", "Macedonian"},
					{"mg", "Malagasy"},
					{"ms", "Malay"},
					{"ml", "Malayalam"},
					{"mt", "Maltese"},
					{"mi", "Maori"},
					{"mr", "Marathi"},
					{"mn", "Mongolian"},
					{"my", "Myanmar (Burmese)"},
					{"ne", "Nepali"},
					{"no", "Norwegian"},
					{"ps", "Pashto"},
					{"fa", "Persian"},
					{"pl", "Polish"},
					{"pt", "Portuguese"},
					{"pa", "Punjabi"},
					{"ro", "Romanian"},
					{"ru", "Russian"},
					{"sm", "Samoan"},
					{"gd", "Scots Gaelic"},
					{"sr", "Serbian"},
					{"st", "Sesotho"},
					{"sn", "Shona"},
					{"sd", "Sindhi"},
					{"si", "Sinhala"},
					{"sk", "Slovak"},
					{"sl", "Slovenian"},
					{"so", "Somali"},
					{"es", "Spanish"},
					{"su", "Sundanese"},
					{"sw", "Swahili"},
					{"sv", "Swedish"},
					{"tg", "Tajik"},
					{"ta", "Tamil"},
					{"te", "Telugu"},
					{"th", "Thai"},
					{"tr", "Turkish"},
					{"uk", "Ukrainian"},
					{"ur", "Urdu"},
					{"uz", "Uzbek"},
					{"vi", "Vietnamese"},
					{"cy", "Welsh"},
					{"xh", "Xhosa"},
					{"yi", "Yiddish"},
					{"yo", "Yoruba"},
					{"zu", "Zulu"}
				};

				return dictLangs.ContainsKey(Model.LanguageInput) ? dictLangs[Model.LanguageInput] : "";
			}
    ]]>
  </RazorFunctions>

</Suite>