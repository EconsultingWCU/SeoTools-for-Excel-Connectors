<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="Lead Generation" Title="Leadfeeder" Id="Leadfeeder" RequireVersion="7.0.0" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Leadfeeder.xml" HelpUrl="http://seotoolsforexcel.com/leadfeeder/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity" />

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/leadfeeder/">
    <Text Id="ApiToken" Title="API Token" Required="true" HelpUrl="http://seotoolsforexcel.com/leadfeeder/"/>
  </Settings>

  <RestConnector Id="AccountHidden" Hidden="true">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="data.*">
        <JsonPath Expr="id" Id="Id" Title="Account Id"/>
        <JsonPath Expr="attributes.name" Id="Name" Title="Account Name"/>
      </JsonPath>
    </Parse>
  </RestConnector>

  <RestConnector Id="Accounts" Title="Accounts" HelpUrl="http://docs.leadfeeder.com/api/#accounts">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="data.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="attributes.name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="attributes.subscription" Id="Subscription" Title="Subscription" Converter="String"/>
        <JsonPath Expr="attributes.timezone" Id="Timezone" Title="Timezone" Converter="String"/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="AccountLookup" Title="Account Lookup" HelpUrl="http://docs.leadfeeder.com/api/#get-a-specific-account">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="data">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="attributes.name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="attributes.subscription" Id="Subscription" Title="Subscription" Converter="String"/>
        <JsonPath Expr="attributes.timezone" Id="Timezone" Title="Timezone" Converter="String"/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="Leads" Title="Leads" HelpUrl="http://docs.leadfeeder.com/api/#get-leads">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
      <DateInterval Id="DateInterval" Title="Date Interval" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="true"/>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId/leads
          ?start_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
          &end_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
          &page[size]=100
          &page[number]=@(Model.PageCursor.Page+1)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="String"/>
      </JsonPath>
      <JsonPath Expr="$.data.*.attributes">
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="industry" Id="Industry" Title="Industry" Converter="String"/>
        <JsonPath Expr="first_visit_date" Id="FirstVisit" Title="First Visit" Converter="DateTime"/>
        <JsonPath Expr="last_visit_date" Id="LastVisit" Title="Last Visit" Converter="DateTime"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
        <JsonPath Expr="website_url" Id="Website" Title="Website" Converter="String"/>
        <JsonPath Expr="employee_count" Id="Employees" Title="Employees" Converter="Long"/>
        <JsonPath Expr="linkedin_url" Id="LinkedIn" Title="LinkedIn" Converter="String"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="LeadLookup" Title="Lead Lookup" HelpUrl="http://docs.leadfeeder.com/api/#get-a-specific-lead">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
      <Text Id="LeadId" Title="Lead Id" Debug.DefaultValue="259c3460-e18f-11e6-9d17-27c8c12692aa_52gfrhvr5hrEhRr6UuQYtb" Required="true"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId/leads/@(Model.LeadId)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="String"/>
      </JsonPath>
      <JsonPath Expr="$.data.attributes">
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="industry" Id="Industry" Title="Industry" Converter="String"/>
        <JsonPath Expr="first_visit_date" Id="FirstVisit" Title="First Visit" Converter="DateTime"/>
        <JsonPath Expr="last_visit_date" Id="LastVisit" Title="Last Visit" Converter="DateTime"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
        <JsonPath Expr="website_url" Id="Website" Title="Website" Converter="String"/>
        <JsonPath Expr="employee_count" Id="Employees" Title="Employees" Converter="Long"/>
        <JsonPath Expr="linkedin_url" Id="LinkedIn" Title="LinkedIn" Converter="String"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="AllVisits" Title="All Visits" HelpUrl="http://docs.leadfeeder.com/api/#get-all-lead-39-s-visits">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
      <DateInterval Id="DateInterval" Title="Date Interval" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="true"/>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId/visits
          ?start_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
          &end_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
          &page[size]=100
          &page[number]=@(Model.PageCursor.Page+1)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data.*.attributes">
        <JsonPath Expr="lead_id" Id="LeadId" Title="Lead Id" Converter="String"/>
        <JsonPath Expr="source" Id="Source" Title="Source" Converter="String"/>
        <JsonPath Expr="medium" Id="Medium" Title="Medium" Converter="String"/>
        <JsonPath Expr="referring_url" Id="ReferringUrl" Title="Referring URL" Converter="String"/>
        <JsonPath Expr="campaign" Id="Campaign" Title="Campaign" Converter="String"/>
        <JsonPath Expr="page_depth" Id="PageDepth" Title="Page Depth" Converter="Int"/>
        <JsonPath Expr="visit_length" Id="VisitLength" Title="Visit Length" Converter="Double"/>
        <JsonPath Expr="date" Id="Date" Title="Date" Converter="DateTime"/>
        <JsonPath Expr="hour" Id="Hour" Title="Hour" Converter="Int"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="LeadVisits" Title="Lead Visits" HelpUrl="http://docs.leadfeeder.com/api/#get-all-lead-39-s-visits">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
      <Text Id="LeadId" Title="Lead Id" Debug.DefaultValue="259c3460-e18f-11e6-9d17-27c8c12692aa_52gfrhvr5hrEhRr6UuQYtb" Required="true"/>
      <DateInterval Id="DateInterval" Title="Date Interval" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="true"/>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId/leads/@(Model.LeadId)/visits
          ?start_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
          &end_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
          &page[size]=100
          &page[number]=@(Model.PageCursor.Page+1)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.data.*.attributes">
        <JsonPath Expr="source" Id="Source" Title="Source" Converter="String"/>
        <JsonPath Expr="medium" Id="Medium" Title="Medium" Converter="String"/>
        <JsonPath Expr="referring_url" Id="ReferringUrl" Title="Referring URL" Converter="String"/>
        <JsonPath Expr="campaign" Id="Campaign" Title="Campaign" Converter="String"/>
        <JsonPath Expr="page_depth" Id="PageDepth" Title="Page Depth" Converter="Int"/>
        <JsonPath Expr="visit_length" Id="VisitLength" Title="Visit Length" Converter="Double"/>
        <JsonPath Expr="date" Id="Date" Title="Date" Converter="DateTime"/>
        <JsonPath Expr="hour" Id="Hour" Title="Hour" Converter="Int"/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="AllVisitRoutes" Title="All Visit Routes" HelpUrl="http://docs.leadfeeder.com/api/#get-all-lead-39-s-visits">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
      <DateInterval Id="DateInterval" Title="Date Interval" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="true"/>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId/visits
          ?start_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
          &end_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
          &page[size]=100
          &page[number]=@(Model.PageCursor.Page+1)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
     <Table DefaultConverter="auto">
        <JsonPath Id="Headers" Expr="keys($.data[0].attributes.visit_route[0])">
					<Compute Id="Headers" Title="Headers">
						<Compute.Expr>
							<![CDATA[
							@{
								string Cleaned = "";
								string Cleaned2 = "";
								if(Model.KeyInput is string)
								{
									Cleaned = Regex.Replace(Model.KeyInput, "_", " ");
									Cleaned2 = Utils.Capitalize(Cleaned);
								}
							}
							@Cleaned2
							]]>
						</Compute.Expr>
						<JsonPath Expr="key" Id="KeyInput"/>
					</Compute>
        </JsonPath>
        <JsonPath Id="Cells" Expr="keys($.data.*.attributes.visit_route.*)">
          <JsonPath Expr="value"/>
        </JsonPath>
      </Table>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="VisitRoutes" Title="Lead Visit Routes" HelpUrl="http://docs.leadfeeder.com/api/#get-all-lead-39-s-visits">
    <Parameters>
      <Text Id="AccountId" Title="Account Id" Debug.DefaultValue="47431" Required="true" Select.Connector="AccountHidden" Select.IdField="Id" Select.TitleField="Name"/>
      <Text Id="LeadId" Title="Lead Id" Debug.DefaultValue="85dd66a0-27d4-11e8-884f-055de2fd8ea0_gdR8XK1uzUEMo6RuiF9bJE" Required="true"/>
      <DateInterval Id="DateInterval" Title="Date Interval" Required="true"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="true"/>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'>Token token=@(Model.ApiToken)</Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
					https://api.leadfeeder.com/accounts/@Model.AccountId/leads/@(Model.LeadId)/visits
          ?start_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.StartDate).ToString("yyyy-MM-dd"))
          &end_date=@Utils.UrlEncode(((DateTime)Model.DateInterval.EndDate).ToString("yyyy-MM-dd"))
          &page[size]=100
          &page[number]=@(Model.PageCursor.Page+1)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
     <Table DefaultConverter="auto">
        <JsonPath Id="Headers" Expr="keys($.data[0].attributes.visit_route[0])">
					<Compute Id="Headers" Title="Headers">
						<Compute.Expr>
							<![CDATA[
							@{
								string Cleaned = "";
								string Cleaned2 = "";
								if(Model.KeyInput is string)
								{
									Cleaned = Regex.Replace(Model.KeyInput, "_", " ");
									Cleaned2 = Utils.Capitalize(Cleaned);
								}
							}
							@Cleaned2
							]]>
						</Compute.Expr>
						<JsonPath Expr="key" Id="KeyInput"/>
					</Compute>
        </JsonPath>
        <JsonPath Id="Cells" Expr="keys($.data.*.attributes.visit_route.*)">
          <JsonPath Expr="value"/>
        </JsonPath>
      </Table>
    </Parse>
    <Fail>
      <JsonPath Expr="$.errors.*.title"/>
    </Fail>
  </RestConnector>

</Suite>
