<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="GeoNames" Id="GeoNames" RequireVersion="8.2" Category="GEO" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/GeoNames.xml" HelpUrl="http://seotoolsforexcel.com/geonames/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/geonames/">
    <Text Id="Username" Title="Username" Required="true" HelpUrl="http://seotoolsforexcel.com/geonames/"/>
  </Settings>

  <RestConnector Id="GeoNames" Title="GeoNames" HelpUrl="http://www.geonames.org/export/geonames-search.html">
    <Parameters>
      <Text Id="Query" Title="Query" Required="true" Debug.DefaultValue="jönköping" HelpText="Search place name, country name, continent etc."/>
      <Select Id="Country" Title="Filter by Country" DefaultValue="all">
        <DataSource>
					<Item Id="all" Title="All"/>
          <ISOCountryCodes/>
        </DataSource>
      </Select>
		 <Select Id="SearchMode" Title="Search Mode" DefaultValue="name">
        <DataSource>
          <Item Id="name" Title="Name only"/>
          <Item Id="name_equals" Title="Exact name"/>
          <Item Id="name_starts" Title="Nam starts With"/>
					<Item Id="query" Title="Search all attributes"/>
        </DataSource>
      </Select>
			<Checkbox Id="Fuzzy" Title="Fuzzy" HelpText="Fuzzy means finding results even if the search terms are incorrectly spelled."/>
      <Select Id="Order" Title="Order by" DefaultValue="relevance">
        <DataSource>
          <Item Id="relevance" Title="Relevance"/>
          <Item Id="population" Title="Population"/>
          <Item Id="elevation" Title="Elevation"/>
        </DataSource>
      </Select>
		</Parameters>
    <Paging PageSize="100" EvenPages="false">
      <Parse>
        <JsonPath Id="AvaliableRows" Expr="totalResultsCount"/>
      </Parse>
    </Paging>
  <Fetch>
    <Fetch.Url>
      <![CDATA[
      http://api.geonames.org/searchJSON?username=@(Model.Username)
			&(Model.SearchMode)=(Utils.UrlEncode(Model.Query))
      @(Model.Fuzzy ? "&fuzzy=0" : "")
			@(Model.Country != "all" ? "country=" + Model.Country : "")
      &orderby=@(Model.Order)
      &maxRows=@(Model.PageCursor.PageSize)
      &startRow=@(Model.PageCursor.NextSkip)
      ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="geonames.*">
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String" HelpText="Localized name, the preferred name in the optional language parameter."/>
        <JsonPath Expr="fcodeName" Id="Type" Title="Type" Converter="String" HelpText="The classification of the location."/>
        <JsonPath Expr="adminName1" Id="Region" Title="Region" Converter="String" HelpText="Region of location."/>
        <JsonPath Expr="countryName" Id="CountryName" Title="Country Name" Converter="String" HelpText="Country Name which the location belongs to."/>
        <JsonPath Expr="countryCode" Id="CountryCode" Title="Country Code" Converter="String" HelpText="Country Code which the location belongs to."/>
        <JsonPath Expr="population" Id="Population" Title="Population" Converter="Long" HelpText="Population of the location."/>
        <JsonPath Expr="toponymName" Id="ToponymName" Title="Toponym Name" Converter="String" HelpText="main name of the toponym as displayed on the google maps interface page."/>
        <JsonPath Expr="lat" Id="Latitude" Title="Latitude" Converter="Double" HelpText="Latitude of location."/>
        <JsonPath Expr="lng" Id="Longitude" Title="Longitude" Converter="Double" HelpText="Longitude of location."/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="status.message"/>
    </Fail>
  </RestConnector>

</Suite>
