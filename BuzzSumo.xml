<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="Social" Title="BuzzSumo" Id="BuzzSumo" RequireVersion="8.2" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/BuzzSumo.xml" HelpUrl="http://seotoolsforexcel.com/buzzsumo/" HelpText="Documentation">

  <Author Name="Dovydas Meilunas" Url="https://github.com/dovydasm"/>

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/buzzsumo/">
    <Text Id="ApiKey" Title="API Key" Required="true" HelpUrl="http://seotoolsforexcel.com/buzzsumo/"/>
  </Settings>

  <Resources>
    <Resource Id="PersonTypes">
      <Item Id="all" Title="All"/>
      <Item Id="blogger" Title="Bloggers"/>
      <Item Id="influencer" Title="Influencers"/>
      <Item Id="company" Title="Companies"/>
      <Item Id="journalist" Title="Journalists"/>
      <Item Id="regular" Title="Regular people"/>
    </Resource>
    <Resource Id="Fail">
      <Fail>
        <JsonPath Expr="error"/>
      </Fail>
    </Resource>
  </Resources>

  <RestConnector Id="MostShared" Title="Most Shared Content" HelpUrl="http://buzzsumo.com/knowledge/top-content-api/">
    <Parameters>
      <Text Id="Query" Title="Keyword/URL" Required="true"/>
      <Select Id="ResultType" Title="Sort by" DefaultValue="total" Required="false">
        <DataSource>
          <Item Id="total" Title="Total"/>
          <Item Id="facebook" Title="Facebook"/>
          <Item Id="twitter" Title="Twitter"/>
          <Item Id="linkedin" Title="LinkedIn"/>
          <Item Id="pinterest" Title="Pinterest"/>
          <Item Id="google_plus" Title="Google Plus"/>
        </DataSource>
      </Select>
      <Select Id="ArticleType" Title="Article Type" DefaultValue="all">
        <DataSource>
          <Item Id="all" Title="All"/>
          <Item Id="general_article " Title="Articles"/>
          <Item Id="video" Title="Videos"/>
          <Item Id="list" Title="List Articles"/>
          <Item Id="how_to_article" Title="'How to' articles"/>
          <Item Id="what_post" Title="'What is X' articles"/>
          <Item Id="why_post" Title="'Why' articles"/>
          <Item Id="infographic" Title="Articles with infographics"/>
        </DataSource>
      </Select>
      <DateInterval Id="DateInterval" Title="Interval" Required="false" Nullabe="true"/>
      <Select Id="Language" Title="Language" Required="false" DefaultValue="all">
        <DataSource>
					<Item Id="all" Title="All"/>
          <ISOLanguageCodes/>
        </DataSource>
      </Select>
      <Text Id="Tld" Title="Top-Level Domain" Required="false"/>
      <Checkbox Id="B2b" Title="Only include results from Business to Business publishers" DefaultValue="False"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false"/>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        http://api.buzzsumo.com/search/articles.json?
        api_key=@(Model.ApiKey)
        &q=@(Utils.UrlEncode(Model.Query))
        @if(Model.ResultType != "total")
        {
          @: &result_type=@(Model.ResultType)
        }
        @if(Model.ArticleType != "all")
        {
          @: &article_type=@(Model.ArticleType)
        }
        @if(Model.DateInterval.StartDate != null && Model.DateInterval.EndDate != null)
        {
          @: &begin_date=@(((DateTime)Model.DateInterval.StartDate).UnixTimeStampUtc())
          @: &end_date=@(((DateTime)Model.DateInterval.EndDate).UnixTimeStampUtc())
        }
        @(Model.Language != "all" ? "&language=" + Model.Language : "")
        @if(!string.IsNullOrEmpty(Model.Tld))
        {
          @: &tld=@(Model.Language.Replace(",", "").Replace(" ", ""))
        }
        @if(Model.B2b == true)
        {
          @: &b2b_publishers=true
        }
        @if(Model.PageCursor.Page != 0)
        {
          @: page=@Model.PageCursor.Page
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.results.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="author_name" Id="AuthorName" Title="Author Name" Converter="String"/>
        <JsonPath Expr="alexa_rank" Id="AlexaRank" Title="Alexa Rank" Converter="Int"/>
        <JsonPath Expr="pinterest_shares" Id="PinterestShares" Title="Pinterest Shares" Converter="Int"/>
        <JsonPath Expr="num_words" Id="NumWords" Title="Words" Converter="Int"/>
        <JsonPath Expr="twitter_shares" Id="TwitterShares" Title="Twitter Shares" Converter="Int"/>
				<Compute Expr="@Utils.IsoLanguageCodeToName(Model.Inp)" Id="Language" Converter="Auto">
					<JsonPath Expr="language" Id="Inp" DefaultValue=""/>
				</Compute>				
        <JsonPath Expr="og_url" Id="OgUrl" Title="Og. Url" Converter="String" Checked="false"/>
        <JsonPath Expr="video" Id="Video" Title="Video" Converter="Bool"/>
        <JsonPath Expr="title" Id="Title" Title="Title" Converter="String"/>
        <JsonPath Expr="evergreen_score" Id="EvergreenScore" Title="Evergreen Score" Converter="Float"/>
        <JsonPath Expr="total_shares_with_pinterest" Id="TotalSharesWithPinterest" Title="Pinterest Shares" Converter="Int"/>
        <JsonPath Expr="domain_name" Id="DomainName" Title="Domain Name" Converter=""/>
        <Compute Id="UpdatedAt" Title="Updated" Expr="@(DateTimeOffset.FromUnixTimeSeconds((long)Model.Inp))" Converter="DateTime">
          <JsonPath Expr="updated_at" Id="Inp" Converter="Long"/>
        </Compute>
        <JsonPath Expr="facebook_likes" Id="FacebookLikes" Title="Facebook Likes" Converter="Int"/>
        <JsonPath Expr="facebook_comments" Id="FacebookComments" Title="Facebook Comments" Converter="Int"/>
        <JsonPath Expr="thumbnail" Id="Thumbnail" Title="Thumbnail" Converter="String"/>
        <JsonPath Expr="twitter_user_id" Id="TwitterUser Id" Title="Twitter User Id" Converter="String"/>
        <JsonPath Expr="total_facebook_shares" Id="TotalFacebook Shares" Title="Total Facebook Shares" Converter="Int"/>
        <JsonPath Expr="url" Id="Url" Title="Url" Converter="String"/>
        <JsonPath Expr="linkedin_shares" Id="LinkedinShares" Title="Linkedin Shares" Converter="Int"/>
        <JsonPath Expr="facebook_shares" Id="FacebookShares" Title="Facebook Shares" Converter="Int"/>
        <JsonPath Expr="num_linking_domains" Id="NumLinking Domains" Title="Linking Domains" Converter="Int"/>
        <JsonPath Expr="subdomain" Id="Subdomain" Title="Subdomain" Converter="String"/>
        <Compute Id="PublishedDate" Title="Published" Expr="@(DateTimeOffset.FromUnixTimeSeconds((long)Model.Inp))" Converter="DateTime">
          <JsonPath Expr="published_date" Id="Inp" Converter="Long"/>
        </Compute>
        <JsonPath Expr="total_shares" Id="TotalShares" Title="Total Shares" Converter="Int"/>
        <JsonPath Expr="display_title" Id="DisplayTitle" Title="Display Title" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Influencers" Title="Influencers" HelpUrl="http://buzzsumo.com/knowledge/influencers-api/">
    <Parameters>
      <Text Id="Query" Title="Keyword/Topic" Required="true"/>
      <Select Id="ResultType" Title="Sort by" DefaultValue="total" Required="false">
        <DataSource>
          <Item Id="avg_retweets" Title="Avg. retweets"/>
          <Item Id="num_followers" Title="Follower count"/>
          <Item Id="page_authority" Title="Page authority"/>
          <Item Id="pagerank" Title="Pagerank"/>
          <Item Id="retweet_ratio" Title="Retweet ratio"/>
          <Item Id="reply_ratio" Title="Reply ratio"/>
        </DataSource>
      </Select>
      <Select Id="PersonTypes" Title="PersonTypes" DefaultValue="all" Required="false">
        <DataSource>
          <Resource Id="PersonTypes"/>
        </DataSource>
      </Select>
      <Text Id="Location" Title="Location" Required="false" HelpText="You can pass multiple location separated with the OR operator e.g. London OR New York OR Germany etc."/>
      <Checkbox Id="IgnoreBroadcasters" Title="Ignore broadcasters" DefaultValue="False" HelpText=" Broadcasters are influencers who simply broadcast links or tweets and hardly reply to others."/>
      <Checkbox Id="WithInstagram" Title="Only profiles with Instagram username" DefaultValue="False"/>
      <Checkbox Id="InfluencersOnly" Title="Remove punctunation and delimiters" DefaultValue="False"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false"/>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        http://api.buzzsumo.com/search/influencers.json?
        api_key=@(Model.ApiKey)
        &q=@Utils.UrlEncode(Model.Query)
        @if(Model.ResultType != "avg_retweets")
        {
          @: &result_type=@(Model.ResultType)
        }
        @if(!string.IsNullOrEmpty(Model.Location))
        {
          @: &location=@(Utils.UrlEncode(Model.Location))
        }
        @if(Model.PersonTypes != "all")
        {
          @: &person_types=@(Model.PersonTypes)
        }
        @if(Model.WithInstagram == true)
        {
          @: &must_have_instagram_profile=true
        }
        @if(Model.InfluencersOnly == true)
        {
          @: &verified_only=true
        }
        @if(Model.IgnoreBroadcasters == true)
        {
          @: &ignore_broadcasters=true
        }
        @if(Model.PageCursor.Page != 0)
        {
          @: page=@Model.PageCursor.Page
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.results.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="username" Id="Username" Title="Username" Converter="String"/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="num_followers" Id="NumFollowers" Title="Followers" Converter="Int"/>
        <JsonPath Expr="num_following" Id="NumFollowing" Title="Following" Converter="Int"/>
        <JsonPath Expr="pagerank" Id="Pagerank" Title="Pagerank" Converter="Int"/>
        <JsonPath Expr="location" Id="Location" Title="Location" Converter="String"/>
        <JsonPath Expr="reply_ratio" Id="ReplyRatio" Title="Reply Ratio" Converter="Double"/>
        <JsonPath Expr="retweet_ratio" Id="RetweetRatio" Title="Retweet Ratio" Converter="Double"/>
        <JsonPath Expr="twitter_id_str" Id="TwitterIdStr" Title="Twitter Id" Converter="Int"/>
        <JsonPath Expr="image" Id="Image" Title="Image" Converter="String"/>
        <JsonPath Expr="url_share_ratio" Id="UrlShareRatio" Title="Url Share Ratio" Converter="Int"/>
        <JsonPath Expr="url" Id="Url" Title="Url" Converter="String"/>
        <JsonPath Expr="domain_authority" Id="DomainAuthority" Title="Domain Authority" Converter="Int"/>
        <JsonPath Expr="page_authority" Id="PageAuthority" Title="Page Authority" Converter="Int"/>
        <JsonPath Expr="bio" Id="Bio" Title="Bio" Converter="String"/>
        <JsonPath Expr="avg_retweets" Id="AvgRetweets" Title="Avg Retweets" Converter="Double"/>
        <JsonPath Expr="instagram_username" Id="InstagramUsername" Title="Instagram Username" Converter="Auto"/>
        <JsonPath Expr="instagram_authority" Id="InstagramAuthority" Title="Instagram Authority" Converter="Auto"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="ArticleSharers" Title="Article Sharers" HelpUrl="http://buzzsumo.com/knowledge/sharers-api/">
    <Parameters>
      <Text Id="ArticleId" Title="Article Id" Required="true"/>
      <Select Id="ResultType" Title="Sort by" DefaultValue="relevancy" Required="false">
        <DataSource>
          <Item Id="relevancy" Title="Relevancy"/>
          <Item Id="num_followers" Title="Number of followers"/>
          <Item Id="page_authority" Title="Page Authority"/>
          <Item Id="pagerank" Title="Pagerank"/>
          <Item Id="retweet_ratio" Title="Retweet Ratio"/>
          <Item Id="reply_ratio" Title="Reply Ratio"/>
          <Item Id="avg_retweets" Title="Avg. retweets"/>
        </DataSource>
      </Select>
      <Select Id="PersonTypes" Title="PersonTypes" DefaultValue="all" Required="false">
        <DataSource>
          <Resource Id="PersonTypes"/>
        </DataSource>
      </Select>
      <Text Id="Location" Title="Location" Required="false" HelpText="You can pass multiple location separated with the OR operator e.g. London OR New York OR Germany etc."/>
      <Checkbox Id="IgnoreBroadcasters" Title="Ignore broadcasters" DefaultValue="False" HelpText=" Broadcasters are influencers who simply broadcast links or tweets and hardly reply to others."/>
      <Checkbox Id="WithInstagram" Title="Only profiles with Instagram username" DefaultValue="False"/>
      <Checkbox Id="InfluencersOnly" Title="Remove punctunation and delimiters" DefaultValue="False"/>
    </Parameters>
    <Paging PageSize="100" EvenPages="false"/>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        http://api.buzzsumo.com/search/shares.json?
        api_key=@(Model.ApiKey)
        &article_id=@Utils.UrlEncode(Model.ArticleId)
        @if(Model.ResultType != "relevancy")
        {
          @: &result_type=@(Model.ResultType)
        }
        @if(Model.PersonTypes != "all")
        {
          @: &person_types=@(Model.PersonTypes)
        }
        @if(Model.IgnoreBroadcasters == true)
        {
          @: &ignore_broadcasters=true
        }
        @if(Model.PageCursor.Page != 0)
        {
          @: page=@Model.PageCursor.Page
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.results.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="username" Id="Username" Title="Username" Converter=""/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter=""/>
        <JsonPath Expr="num_following" Id="NumFollowing" Title="Following" Converter="Int"/>
        <JsonPath Expr="pagerank" Id="Pagerank" Title="Pagerank" Converter="Int"/>
        <JsonPath Expr="location" Id="Location" Title="Location" Converter="String"/>
        <JsonPath Expr="reply_ratio" Id="ReplyRatio" Title="Reply Ratio" Converter="Int"/>
        <JsonPath Expr="retweet_ratio" Id="RetweetRatio" Title="Retweet Ratio" Converter="Int"/>
        <JsonPath Expr="person_type" Id="PersonType" Title="Person Type" Converter="String"/>
        <JsonPath Expr="twitter_id_str" Id="TwitterId Str" Title="Twitter Id" Converter="Int"/>
        <JsonPath Expr="image" Id="Image" Title="Image" Converter="String"/>
        <JsonPath Expr="url_share_ratio" Id="UrlShare Ratio" Title="Url Share Ratio" Converter="Int"/>
        <JsonPath Expr="url" Id="Url" Title="Url" Converter="String"/>
        <JsonPath Expr="domain_authority" Id="DomainAuthority" Title="Domain Authority" Converter="Int"/>
        <JsonPath Expr="page_authority" Id="PageAuthority" Title="Page Authority" Converter="Int"/>
        <JsonPath Expr="bio" Id="Bio" Title="Bio" Converter="String"/>
        <JsonPath Expr="avg_retweets" Id="AvgRetweets" Title="Avg. Retweets" Converter="Double"/>
        <JsonPath Expr="num_followers" Id="NumFollowers" Title="Followers" Converter="Int"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="SharedLinks" Title="Shared Links" HelpUrl="http://buzzsumo.com/knowledge/links-shared-api/">
    <Parameters>
      <Text Id="Username" Title="Username" Required="true"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        http://api.buzzsumo.com/search/shared_links.json?
        api_key=@(Model.ApiKey)
        &username=@Utils.UrlEncode(Model.Username)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="url" Id="Url" Title="Url" Converter="String"/>
        <JsonPath Expr="title" Id="Title" Title="Title" Converter="String"/>
        <JsonPath Expr="article_id" Id="ArticleId" Title="Article Id" Converter="Int"/>
        <Compute Id="PublishedAt" Title="Published" Expr="@(DateTimeOffset.FromUnixTimeSeconds((long)Model.Inp))" Converter="DateTime">
          <JsonPath Expr="published_date" Id="Inp" Converter="Long"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Trending" Title="Trending" HelpUrl="http://buzzsumo.com/knowledge/trending-api/">
    <Parameters>
      <Select Id="SearchType" Title="Sort by" DefaultValue="trending_now">
        <DataSource>
          <Item Id="trending_now" Title="Trending score"/>
          <Item Id="most_shared" Title="Total shares"/>
        </DataSource>
      </Select>
      <Text Id="Topic" Title="Topic" Required="false"/>
      <Text Id="Tld" Title="Top-Level Domain" Required="false" HelpText="com, uk, org, etc."/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
        http://api.buzzsumo.com/search/trends.json?
        api_key=@(Model.ApiKey)
        &search_type=@(Model.SearchType)
        @if(!string.IsNullOrEmpty(Model.Topic))
        {
          @: &topic=@(Utils.UrlEncode(Model.Topic))
        }
        @if(!string.IsNullOrEmpty(Model.Tld))
        {
          @: &tld=(Utils.UrlEncode(Model.Tld))
        }
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.results.*">
        <JsonPath Expr="linkedin_shares" Id="LinkedinShares" Title="Linkedin Shares" Converter="Int"/>
        <JsonPath Expr="twitter_user_id" Id="TwitterUserId" Title="Twitter User Id" Converter="Int"/>
        <JsonPath Expr="total_shares_with_pinterest" Id="TotalShares With Pinterest" Title="Total Shares With Pinterest" Converter="Int"/>
        <JsonPath Expr="article_types" Id="ArticleTypes" Title="Article Types" Converter="String"/>
        <JsonPath Expr="twitter_shares" Id="TwitterShares" Title="Twitter Shares" Converter="Int"/>
        <JsonPath Expr="article_amplifiers" Id="ArticleAmplifiers" Title="Article Amplifiers" Converter="String"/>
        <JsonPath Expr="og_url" Id="OgUrl" Title="Og Url" Converter="String"/>
        <JsonPath Expr="url" Id="Url" Title="Url" Converter="String"/>
        <JsonPath Expr="pinterest_shares" Id="PinterestShares" Title="Pinterest Shares" Converter="Int"/>
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="String"/>
        <JsonPath Expr="total_shares" Id="TotalShares" Title="Total Shares" Converter="Int"/>
        <JsonPath Expr="title" Id="Title" Title="Title" Converter="String"/>
        <JsonPath Expr="thumbnail" Id="Thumbnail" Title="Thumbnail" Converter="String"/>
        <JsonPath Expr="subdomain" Id="Subdomain" Title="Subdomain" Converter="String"/>
        <JsonPath Expr="author_name" Id="AuthorName" Title="Author Name" Converter="String"/>
        <JsonPath Expr="num_words" Id="NumWords" Title="Num Words" Converter="Int"/>
        <JsonPath Expr="domain_name" Id="DomainName" Title="Domain Name" Converter="String"/>
        <JsonPath Expr="total_facebook_shares" Id="TotalFacebookShares" Title="Total Facebook Shares" Converter="Int"/>
        <JsonPath Expr="trending_score" Id="TrendingScore" Title="Trending Score" Converter="Int"/>
        <JsonPath Expr="giveaway" Id="Giveaway" Title="Giveaway" Converter="Bool"/>
        <JsonPath Expr="infographic" Id="Infographic" Title="Infographic" Converter="Bool"/>
        <JsonPath Expr="general_article" Id="GeneralArticle" Title="General Article" Converter="Bool"/>
        <JsonPath Expr="guest_post" Id="GuestPost" Title="Guest Post" Converter="Bool"/>
        <JsonPath Expr="interview" Id="Interview" Title="Interview" Converter="Bool"/>
        <JsonPath Expr="video" Id="Video" Title="Video" Converter="Bool"/>
        <Compute Id="PublishedAt" Title="Published" Expr="@(DateTimeOffset.FromUnixTimeSeconds((long)Model.Inp))" Converter="DateTime">
          <JsonPath Expr="published_date" Id="Inp" Converter="Long"/>
        </Compute>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

</Suite>