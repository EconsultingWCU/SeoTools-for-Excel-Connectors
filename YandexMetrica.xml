<?xml version="1.0" encoding="utf-8" ?>
<Suite Category="SEO" Title="Yandex Metrica" Id="YandexMetrica" RequireVersion="7.0" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Yandex.Metrica.xml" HelpUrl="http://seotoolsforexcel.com/yandex-metrica/">

  <Author Name="Dovydas Meilunas" Url="https://github.com/dovydasm"/>

  <DefaultOAuthAuthenticator StayAuthenticated="true" TokenName="access_token" AuthUrl=" https://oauth.yandex.com/authorize?response_type=token&amp;client_id=32cb22bd3ab948ef8d47dd2713ec62b5"/>

  <Resources>
    <Resource Id="Metrics">
      <Item Id="ym:s:visits" Title="Sessions" Group="Basic Metrics" HelpText="Total number of visits."/>
      <Item Id="ym:s:pageviews" Title="Pageviews" Group="Basic Metrics" HelpText="Number of page views on the site in the reporting period."/>
      <Item Id="ym:s:users" Title="Users" Group="Basic Metrics" HelpText="Number of unique users."/>
      <Item Id="ym:s:bounceRate" Title="Bounce rate" Group="Behavior" HelpText="Percentage of sessions, during which at least one page view lasting less than 15 seconds took place."/>
      <Item Id="ym:s:pageDepth" Title="Page depth" Group="Behavior" HelpText="Number of pages viewed by users during visit."/>
      <Item Id="ym:s:avgVisitDurationSeconds" Title="Time on site" Group="Behavior" HelpText="Average session duration in minutes and seconds."/>
      <Item Id="ym:s:visitsPerDay" Title="Sessions per day" Group="Behavior" />
      <Item Id="ym:s:visitsPerHour" Title="Sessions per hour" Group="Behavior" />
      <Item Id="ym:s:visitsPerMinute" Title="Sessions per minute" Group="Behavior" />
      <Item Id="ym:s:robotPercentage" Title="Percentage of robots" Group="Behavior" HelpText="Percentage of users who are suspected to be robots."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;conversionRate" Title="Conversion rate" Group="Conversions" HelpText="Share of conversions in the total number of visits."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;userConversionRate" Title="User conversion rate" Group="Conversions" HelpText="Percentage of converted sessions among the total number of unique users."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;users" Title="Converted users" Group="Conversions" HelpText="Number of unique users that reached goals."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;visits" Title="Conversions" Group="Conversions" HelpText="Number of converted sessions."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;reaches" Title="Goals reached" Group="Conversions" HelpText="Total number of conversions in all targeted visits."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;reachesPerUser" Title="Conversions per user" Group="Conversions" HelpText="Average number of conversions per unique converted user."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;revenue" Title="Revenue" Group="Conversions" />
      <Item Id="ym:s:goal&lt;goal_id&gt;&lt;currency&gt;revenue" Title="Revenue in currency" Group="Conversions" />
      <Item Id="ym:s:goal&lt;goal_id&gt;conversionRate" Title="Conversion rate" Group="Conversions" HelpText="Share of conversions in the total number of visits."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;userConversionRate" Title="User conversion rate" Group="Conversions" HelpText="Percentage of converted sessions among the total number of unique users."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;users" Title="Converted users" Group="Conversions" HelpText="Number of unique users that reached goals."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;visits" Title="Conversions" Group="Conversions" HelpText="Number of converted sessions."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;reaches" Title="Goals reached" Group="Conversions" HelpText="Total number of conversions in all targeted visits."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;reachesPerUser" Title="Conversions per user" Group="Conversions" HelpText="Average number of conversions per unique converted user."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;revenue" Title="Revenue" Group="Conversions" />
      <Item Id="ym:s:goal&lt;goal_id&gt;&lt;currency&gt;revenue" Title="Revenue in currency" Group="Conversions" />
      <Item Id="ym:s:goal&lt;goal_id&gt;conversionRate" Title="Conversion rate" Group="Conversions" HelpText="Share of conversions in the total number of visits."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;userConversionRate" Title="User conversion rate" Group="Conversions" HelpText="Percentage of converted sessions among the total number of unique users."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;users" Title="Converted users" Group="Conversions" HelpText="Number of unique users that reached goals."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;visits" Title="Conversions" Group="Conversions" HelpText="Number of converted sessions."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;reaches" Title="Goals reached" Group="Conversions" HelpText="Total number of conversions in all targeted visits."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;reachesPerUser" Title="Conversions per user" Group="Conversions" HelpText="Average number of conversions per unique converted user."/>
      <Item Id="ym:s:goal&lt;goal_id&gt;revenue" Title="Revenue" Group="Conversions" />
      <Item Id="ym:s:goal&lt;goal_id&gt;&lt;currency&gt;revenue" Title="Revenue in currency" Group="Conversions" />
      <Item Id="ungrouped1" Title="Ungrouped1" HelpText="Ungrouped1 help"/>
      <Item Id="ungrouped2" Title="Ungrouped2" HelpText="Ungrouped2 help"/>
    </Resource>
    <Resource Id="Fail">
      <Fail>
        <JsonPath Expr="errors.*.message"/>
      </Fail>
    </Resource>
  </Resources>

  <RestConnector Id="Tags" Title="Tags" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/counters/counters-docpage/">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
        https://api-metrica.yandex.com/management/v1/counters
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.counters.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
        <JsonPath Expr="owner_login" Id="OwnerLogin" Title="Owner Username" Converter="String"/>
        <JsonPath Expr="code_status" Id="CodeStatus" Title="Code Status" Converter="String" Checked="false"/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String"/>
        <JsonPath Expr="favorite" Id="Favorite" Title="Favorite" Converter="Bool"/>
        <JsonPath Expr="hide_address" Id="Hide_address" Title="Hide Address" Converter="Bool"/>
        <JsonPath Expr="permission" Id="Permission" Title="Permission" Converter="String"/>
        <JsonPath Expr="create_time" Id="Create_time" Title="Created" Converter="DateTime"/>
        <JsonPath Expr="time_zone_name" Id="TimeZoneName" Title="Timezone" Converter="String"/>
        <JsonPath Expr="time_zone_offset" Id="TimeZoneOffset" Title="Timezone offset" Converter="Int"/>
        <JsonPath Expr="partner_id" Id="PartnerId" Title="Partner Id" Converter="Int"/>
        <JsonPath Expr="site" Id="Site" Title="Site" Converter="String"/>
        <JsonPath Expr="site2.site" Id="Site2" Title="Url" Converter="String"/>
        <JsonPath Expr="gdpr_agreement_accepted" Id="Gdpr_agreement_accepted" Title="GDPR accepted" Converter="String" Checked="false"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="TagsHidden" Title="TagsHidden" Hidden="true" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/counters/counters-docpage/">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
        https://api-metrica.yandex.com/management/v1/counters
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.counters.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Goals" Title="Goals" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/goals/goals-docpage/">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
      <Checkbox Id="ShowDeleted" Title="Include deleted goals" DefaultValue="false"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/counter/@(Model.Tag)/goals?
          useDeleted=@(Model.ShowDeleted)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.goals.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String"/>
        <JsonPath Expr="depth" Id="Depth" Title="Depth" Converter="Int"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Filters" Title="Filters" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/filters/filters-docpage/">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/counter/@(Model.Tag)/filters
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.filters.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="attr" Id="Attribute" Title="Attribute" Converter="String"/>
        <JsonPath Expr="type" Id="Type" Title="Type" Converter="String"/>
        <JsonPath Expr="value" Id="Value" Title="Value" Converter="String"/>
        <JsonPath Expr="action" Id="Action" Title="Action" Converter="String"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
        <JsonPath Expr="start_ip" Id="StartIp" Title="Start IP" Converter="Auto" Checked="false"/>
        <JsonPath Expr="end_ip" Id="EndIp" Title="End Ip" Converter="Auto" Checked="false"/>
        <JsonPath Expr="with_subdomain" Id="WithSubdomains" Title="With Subdomains" Converter="Bool" HelpText="Filter with subdomains"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Actions" Title="Actions" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/operations/operations-docpage/">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/counter/@(Model.Tag)/operations
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.operations.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="attr" Id="Attribute" Title="Attribute" Converter="String"/>
        <JsonPath Expr="value" Id="Value" Title="Value" Converter="String"/>
        <JsonPath Expr="action" Id="Action" Title="Action" Converter="String"/>
        <JsonPath Expr="status" Id="Status" Title="Status" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Permissions" Title="Permissions" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/grants/grants-docpage/" HelpText="Returns information about permissions to manage the counter and view statistics.">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/counter/@(Model.Tag)/grants
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.grants.*">
        <JsonPath Expr="user_login" Id="Username" Title="Username" Converter="String"/>
        <JsonPath Expr="perm" Id="Perm" Title="Permission Type" Converter="String"/>
        <JsonPath Expr="created_at" Id="Created" Title="Created" Converter="DateTime"/>
        <JsonPath Expr="comment" Id="Comment" Title="Comment" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Accounts" Title="Accounts" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/accounts/accounts-docpage/" HelpText="Returns list of accounts, the representative of which is a current user.">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/accounts
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.accounts.*">
        <JsonPath Expr="user_login" Id="Username" Title="Username" Converter="String"/>
        <JsonPath Expr="created_at" Id="Created" Title="Created" Converter="DateTime"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Representatives" Title="Representatives" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/delegates/delegates-docpage/" HelpText="Returns a list of representatives who have been granted full access to the account of the current user.">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/delegates
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.delegates.*">
        <JsonPath Expr="user_login" Id="Username" Title="Username" Converter="String"/>
        <JsonPath Expr="created_at" Id="Created" Title="Created" Converter="DateTime"/>
        <JsonPath Expr="comment" Id="Comment" Title="Comment" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Clients" Title="Yandex.Direct clients" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/direct_clients/getclients-docpage/" HelpText="Returns data about Yandex.Direct clients to campaigns which are accessible to the owner of the Metrica counter.">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/clients?counters=@(Model.Tag)
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.delegates.*">
        <JsonPath Expr="user_login" Id="Username" Title="Username" Converter="String"/>
        <JsonPath Expr="created_at" Id="Created" Title="Created" Converter="DateTime"/>
        <JsonPath Expr="comment" Id="Comment" Title="Comment" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="TagLabels" Title="Tag labels" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/labels/getlabels-docpage/" HelpText="Returns list of tag labels, created by user.">
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/labels
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.labels.*">
        <JsonPath Expr="id" Id="Id" Title="Id" Converter="Int"/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Segments" Title="Segments" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/segments/getsegmentsforcounter-docpage/" HelpText="Returns a list of segments created via the API and pertaining to the specified label.">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/management/v1/counter/@(Model.Tag)/apisegment/segments
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.segments.*">
        <JsonPath Expr="segment_id" Id="SegmentId" Title="Segment Id" Converter="Int"/>
        <JsonPath Expr="counter_id" Id="CounterId" Title="Counter Id" Converter="Int"/>
        <JsonPath Expr="name" Id="Name" Title="Name" Converter="String"/>
        <JsonPath Expr="expression" Id="Expression" Title="Expression" Converter="String"/>
        <JsonPath Expr="segment_source" Id="SegmentSource" Title="Segment Source" Converter="String"/>
      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RestConnector Id="Report" Title="Custom Report" HelpUrl="https://tech.yandex.com/metrika/doc/api2/management/segments/getsegmentsforcounter-docpage/" HelpText="Returns a list of segments created via the API and pertaining to the specified label.">
    <Parameters>
      <Text Id="Tag" Title="Tag" Select.Connector="TagsHidden" Select.IdField="Id" Select.TitleField="Name" Required="true"/>
      <MultiSelect Id="Metrics" Name="Metrics" Required="true" Separator="," Max="100">
        <DataSource>
          <Resource Id="Metrics"/>
        </DataSource>
      </MultiSelect>
    </Parameters>
    <Fetch>
      <HttpSettings>
        <RequestHeaders>
          <Header Name='Authorization'><![CDATA[Bearer @(Model.Authenticator.Token)]]></Header>
        </RequestHeaders>
      </HttpSettings>
      <Fetch.Url>
        <![CDATA[
          https://api-metrica.yandex.com/stat/v1/data?
        ]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="$.*">

      </JsonPath>
    </Parse>
    <Resource Id="Fail"/>
  </RestConnector>

  <RazorFunctions>
  </RazorFunctions>
</Suite>