<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="Majestic" Id="Majestic" RequireVersion="6.1" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/Majestic.xml" HelpUrl="http://seotoolsforexcel.com/Majestic/" HelpText="Documentation">

  <Author Name="Victor Sandberg" Url="http://community.seotoolsforexcel.com/users/diskborste/activity" />

  <Settings HelpText="Whats this?" HelpUrl="http://seotoolsforexcel.com/">
    <Text Id="ApiToken" Title="API Token" Required="true" HelpUrl="http://seotoolsforexcel.com/"/>
  </Settings>
	
  <Resources>
    <Resource Id="OrderAnchors">
      <Item Id="anchor" Title="Anchor"/>
      <Item Id="backlinks" Title="Backlinks"/>
      <Item Id="refpages" Title="Refpages"/>
      <Item Id="refdomains" Title="Refdomains"/>
      <Item Id="first_seen" Title="First Seen"/>
      <Item Id="last_visited" Title="Last Visited"/>
    </Resource>
  </Resources>

  <RestConnector Id="IndexData" Title="Index Data" HelpUrl="https://developer-support.majestic.com/api/commands/get-index-item-info.shtml">
    <Parameters>
      <Text Id="Urls" Title="URL(s)" DefaultValue="seotoolsforexcel.com" Required="true" HelpText="Enter one or more URLs separated by a new line" Multiline="true"/>
      <Radio Id="Datasource" Title="Datasource" DefaultValue="fresh" Required="true">
        <DataSource>
          <Item Id="fresh" Title="Fresh"/>
          <Item Id="historic" Title="Historic"/>
        </DataSource>
      </Radio>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
					https://api.majestic.com/api/json?app_api_key=@(Model.ApiToken)
					&cmd=GetIndexItemInfo
					@FetchUrls()
					&datasource=@(Model.Datasource)
				]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="DataTables.Results.Data[*]">
        <JsonPath Expr="Item" Id="Item" Title="Item" Converter="String" HelpText=""/>
        <JsonPath Expr="CitationFlow" Id="CitationFlow" Title="CitationFlow" Converter="Int" HelpText=""/>
        <JsonPath Expr="TrustFlow" Id="TrustFlow" Title="TrustFlow" Converter="Int" HelpText=""/>
        <JsonPath Expr="TrustMetric" Id="TrustMetric" Title="TrustMetric" Converter="Int" HelpText=""/>
        <JsonPath Expr="ExtBackLinks" Id="ExtBackLinks" Title="ExtBackLinks" Converter="Int" HelpText=""/>
        <JsonPath Expr="ExtBackLinksEDU" Id="ExtBackLinksEDU" Title="ExtBackLinksEDU" Converter="Int" HelpText=""/>
        <JsonPath Expr="ExtBackLinksEDU_Exact" Id="ExtBackLinksEDU_Exact" Title="ExtBackLinksEDU_Exact" Converter="Int" HelpText=""/>
        <JsonPath Expr="ExtBackLinksGOV" Id="ExtBackLinksGOV" Title="ExtBackLinksGOV" Converter="Int" HelpText=""/>
        <JsonPath Expr="ExtBackLinksGOV_Exact" Id="ExtBackLinksGOV_Exact" Title="ExtBackLinksGOV_Exact" Converter="Int" HelpText=""/>
        <JsonPath Expr="IndexedURLs" Id="IndexedURLs" Title="IndexedURLs" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefDomains" Id="RefDomains" Title="RefDomains" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefDomainsEDU" Id="RefDomainsEDU" Title="RefDomainsEDU" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefDomainsEDU_Exact" Id="RefDomainsEDU_Exact" Title="RefDomainsEDU_Exact" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefDomainsGOV" Id="RefDomainsGOV" Title="RefDomainsGOV" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefDomainsGOV_Exact" Id="RefDomainsGOV_Exact" Title="RefDomainsGOV_Exact" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefIPs" Id="RefIPs" Title="RefIPs" Converter="Int" HelpText=""/>
        <JsonPath Expr="RefSubNets" Id="RefSubNets" Title="RefSubNets" Converter="Int" HelpText=""/>
        <JsonPath Expr="CrawledFlag" Id="CrawledFlag" Title="CrawledFlag" Converter="String" HelpText=""/>
        <JsonPath Expr="FinalRedirectResult" Id="FinalRedirectResult" Title="FinalRedirectResult" Converter="String" HelpText=""/>
        <JsonPath Expr="LastCrawlDate" Id="LastCrawlDate" Title="LastCrawlDate" Converter="String" HelpText=""/>
        <JsonPath Expr="LastCrawlResult" Id="LastCrawlResult" Title="LastCrawlResult" Converter="String" HelpText=""/>
        <JsonPath Expr="OutDomainsExternal" Id="OutDomainsExternal" Title="OutDomainsExternal" Converter="Int" HelpText=""/>
        <JsonPath Expr="OutLinksExternal" Id="OutLinksExternal" Title="OutLinksExternal" Converter="Int" HelpText=""/>
        <JsonPath Expr="RedirectFlag" Id="RedirectFlag" Title="RedirectFlag" Converter="String" HelpText=""/>
        <JsonPath Expr="RedirectTo" Id="RedirectTo" Title="RedirectTo" Converter="String" HelpText=""/>
        <JsonPath Expr="ResultCode" Id="ResultCode" Title="ResultCode" Converter="String" HelpText=""/>
        <JsonPath Expr="Status" Id="Status" Title="Status" Converter="String" HelpText=""/>
        <JsonPath Expr="Title" Id="Title" Title="Title" Converter="String" HelpText=""/>
        <JsonPath Expr="TopicalTrustFlow_Topic_0" Id="TopicalTrustFlow_Topic_0" Title="TopicalTrustFlow_Topic_0" Converter="String" HelpText=""/>
        <JsonPath Expr="TopicalTrustFlow_Value_0" Id="TopicalTrustFlow_Value_0" Title="TopicalTrustFlow_Value_0" Converter="String" HelpText=""/>
        <JsonPath Expr="TopicalTrustFlow_Topic_1" Id="TopicalTrustFlow_Topic_1" Title="TopicalTrustFlow_Topic_1" Converter="String" HelpText=""/>
        <JsonPath Expr="TopicalTrustFlow_Value_1" Id="TopicalTrustFlow_Value_1" Title="TopicalTrustFlow_Value_1" Converter="String" HelpText=""/>
        <JsonPath Expr="TopicalTrustFlow_Topic_2" Id="TopicalTrustFlow_Topic_2" Title="TopicalTrustFlow_Topic_2" Converter="String" HelpText=""/>
        <JsonPath Expr="TopicalTrustFlow_Value_2" Id="TopicalTrustFlow_Value_2" Title="TopicalTrustFlow_Value_2" Converter="String" HelpText=""/>
        <JsonPath Expr="ACRank" Id="ACRank" Title="ACRank" Converter="Int" HelpText=""/>
        <JsonPath Expr="AnalysisResUnitsCost" Id="AnalysisResUnitsCost" Title="AnalysisResUnitsCost" Converter="Int" HelpText=""/>
        <JsonPath Expr="DownloadBacklinksAnalysisResUnitsCost" Id="DownloadBacklinksAnalysisResUnitsCost" Title="DownloadBacklinksAnalysisResUnitsCost" Converter="Int" HelpText=""/>
        <JsonPath Expr="DownloadRefDomainBacklinksAnalysisResUnitsCost" Id="DownloadRefDomainBacklinksAnalysisResUnitsCost" Title="DownloadRefDomainBacklinksAnalysisResUnitsCost" Converter="Int" HelpText=""/>
        <JsonPath Expr="GetTopBackLinksAnalysisResUnitsCost" Id="GetTopBackLinksAnalysisResUnitsCost" Title="GetTopBackLinksAnalysisResUnitsCost" Converter="Int" HelpText=""/>
        <JsonPath Expr="ItemNum" Id="ItemNum" Title="ItemNum" Converter="Int" HelpText=""/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText=""/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText=""/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText=""/>
        <JsonPath Expr="ItemType" Id="ItemType" Title="ItemType" Converter="Int" HelpText=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="ErrorMessage"/>
    </Fail>
  </RestConnector>

  <RestConnector Id="BackLinks" Title="BackLinks" HelpUrl="https://developer-support.majestic.com/api/commands/get-back-link-data.shtml">
    <Parameters>
      <Text Id="Url" Title="URL" DefaultValue="seotoolsforexcel.com" Required="true" HelpText="URL/Domain/Subdomain to query"/>
      <Radio Id="Datasource" Title="Datasource" DefaultValue="fresh" Required="true">
        <DataSource>
          <Item Id="fresh" Title="Fresh"/>
          <Item Id="historic" Title="Historic"/>
        </DataSource>
      </Radio>
			<Text Id="MaxResults" Title="MaxResults" DefaultValue="20" Required="true" HelpText="Number o of results to be returned back"/>
    </Parameters>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
					https://api.majestic.com/api/json?app_api_key=@(Model.ApiToken)
					&cmd=GetBackLinkData
					&item=@(Model.Url)
					&Count=@(Model.MaxResults)
					&datasource=@(Model.Datasource)
				]]>
      </Fetch.Url>
    </Fetch>
    <Parse>
      <JsonPath Expr="DataTables.Backlinks.Data[*]">
        <JsonPath Expr="SourceURL" Id="SourceURL" Title="SourceURL" Converter="String" HelpText=""/>
        <JsonPath Expr="TargetURL" Id="TargetURL" Title="TargetURL" Converter="String" HelpText=""/>
        <JsonPath Expr="AnchorText" Id="AnchorText" Title="AnchorText" Converter="String" HelpText=""/>
        <JsonPath Expr="Date" Id="Date" Title="Date" Converter="String" HelpText=""/>
        <JsonPath Expr="DateLost" Id="DateLost" Title="DateLost" Converter="String" HelpText=""/>
        <JsonPath Expr="FirstIndexedDate" Id="FirstIndexedDate" Title="FirstIndexedDate" Converter="String" HelpText=""/>
        <JsonPath Expr="FlagAltText" Id="FlagAltText" Title="FlagAltText" Converter="String" HelpText=""/>
      </JsonPath>
    </Parse>
    <Fail>
      <JsonPath Expr="ErrorMessage"/>
    </Fail>
  </RestConnector>	


  <RazorFunctions>
		<![CDATA[
		string FetchUrls()
		{
			string[] lines = ((string)Model.Urls).Trim().Split('\n').Select(e => e.Trim()).Where(e => !string.IsNullOrEmpty(e)).Take(100).ToArray();
			return string.Join("&",lines.Select((e, i) => "item"+i+"=" + e.ToArray()));
		}
		]]>
	</RazorFunctions>	
</Suite>
