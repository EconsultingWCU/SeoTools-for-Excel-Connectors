<?xml version="1.0" encoding="utf-8" ?>
<Suite Title="eBay" RequireVersion="6.1.2" Id="EBay" SourceUrl="https://github.com/nielsbosma/SeoTools-for-Excel-Connectors/blob/master/eBay.xml" HelpUrl="http://seotoolsforexcel.com/eBay" HelpText="Documentation">

  <Settings HelpText="What's this?" HelpUrl="http://seotoolsforexcel.com/eBay/">
    <Text Id="AppId" Title="App Id" Required="true" HelpUrl="http://seotoolsforexcel.com/eBay/"/>
  </Settings>

  <Author Name="Victor" Url="http://community.seotoolsforexcel.com/users/diskborste/activity"/>

  <Resources>
    <Resource Id="GlobalIds">
		 <Item Id="EBAY-AT" Title="Austria"/>
		 <Item Id="EBAY-AU" Title="Australia"/>
		 <Item Id="EBAY-CH" Title="Switzerland"/>
		 <Item Id="EBAY-DE" Title="Germany"/>
		 <Item Id="EBAY-ENCA" Title="Canada (English)"/>
		 <Item Id="EBAY-ES" Title="Spain"/>
		 <Item Id="EBAY-FR" Title="France"/>
		 <Item Id="EBAY-FRBE" Title="Belgium (French)"/>
		 <Item Id="EBAY-FRCA" Title="Canada (French)"/>
		 <Item Id="EBAY-GB" Title="UK"/>
		 <Item Id="EBAY-HK" Title="Hong Kong"/>
		 <Item Id="EBAY-IE" Title="Ireland"/>
		 <Item Id="EBAY-IN" Title="India"/>
		 <Item Id="EBAY-IT" Title="Italy"/>
		 <Item Id="EBAY-MOTOR" Title="Motors"/>
		 <Item Id="EBAY-MY" Title="Malaysia"/>
		 <Item Id="EBAY-NL" Title="Netherlands"/>
		 <Item Id="EBAY-NLBE" Title="Belgium (Dutch)"/>
		 <Item Id="EBAY-PH" Title="Philippines"/>
		 <Item Id="EBAY-PL" Title="Poland"/>
		 <Item Id="EBAY-SG" Title="Singapore"/>
		 <Item Id="EBAY-US" Title="United States"/>
    </Resource>
    <Resource Id="Sortings">
		 <Item Id="BestMatch" Title="Best Match"/>
		 <Item Id="BidCountFewest" Title="Fewest Bids (Requires 'Auctions Only')"/>
		 <Item Id="BidCountMost" Title="Most Bids (Requires 'Auctions Only')"/>
		 <Item Id="CurrentPriceHighest" Title="Current Highest Price"/>
		 <Item Id="EndTimeSoonest" Title="Soonest End Time"/>
		 <Item Id="PricePlusShippingHighest" Title="Highest Price+Shipping"/>
		 <Item Id="PricePlusShippingLowest" Title="Lowest Price+Shipping"/>
		 <Item Id="StartTimeNewest" Title="Newest Start Time"/>
    </Resource>
    <Resource Id="Currencies">
			<Item Id="AUD" Title="AUD"/>
			<Item Id="BGN" Title="BGN"/>
			<Item Id="BRL" Title="BRL"/>
			<Item Id="CAD" Title="CAD"/>
			<Item Id="CHF" Title="CHF"/>
			<Item Id="CNY" Title="CNY"/>
			<Item Id="CZK" Title="CZK"/>
			<Item Id="DKK" Title="DKK"/>
			<Item Id="GBP" Title="GBP"/>
			<Item Id="HKD" Title="HKD"/>
			<Item Id="HRK" Title="HRK"/>
			<Item Id="HUF" Title="HUF"/>
			<Item Id="IDR" Title="IDR"/>
			<Item Id="ILS" Title="ILS"/>
			<Item Id="INR" Title="INR"/>
			<Item Id="JPY" Title="JPY"/>
			<Item Id="KRW" Title="KRW"/>
			<Item Id="MXN" Title="MXN"/>
			<Item Id="MYR" Title="MYR"/>
			<Item Id="NOK" Title="NOK"/>
			<Item Id="NZD" Title="NZD"/>
			<Item Id="PHP" Title="PHP"/>
			<Item Id="PLN" Title="PLN"/>
			<Item Id="RON" Title="RON"/>
			<Item Id="RUB" Title="RUB"/>
			<Item Id="SEK" Title="SEK"/>
			<Item Id="SGD" Title="SGD"/>
			<Item Id="THB" Title="THB"/>
			<Item Id="TRY" Title="TRY"/>
			<Item Id="ZAR" Title="ZAR"/>
			<Item Id="EUR" Title="EUR"/>
			<Item Id="USD" Title="USD"/>
    </Resource>		
  </Resources>

  <RestConnector Id="ItemsSearch" Title="Items Search" Hidden="false">
    <Parameters>
      <Text Id="Query" Title="Query" DefaultValue="" Required="true" Debug.DefaultValue="missile command"/>
      <Checkbox Id="ListingType" Title="Auctions Only" DefaultValue="false"/>
      <Checkbox Id="FreeShippingOnly" Title="Free Shipping" DefaultValue="false"/>
      <Text Id="MinPrice" Title="Min Price" DefaultValue="0" Required="true" Debug.DefaultValue="0"/>			
      <Text Id="MaxPrice" Title="Max Price" DefaultValue="1000" Required="true" Debug.DefaultValue="1000"/>
      <Select Id="Currency" Title="Currency" Required="false" DefaultValue="USD">
        <DataSource>
          <Resource Id="Currencies"/>
        </DataSource>
      </Select>			
      <Select Id="GlobalId" Title="eBay Site" Required="false" DefaultValue="EBAY-US">
        <DataSource>
          <Resource Id="GlobalIds"/>
        </DataSource>
      </Select>
      <Select Id="Sorting" Title="Sort Results by" Required="false" DefaultValue="BestMatch">
        <DataSource>
          <Resource Id="Sortings"/>
        </DataSource>
      </Select>
    </Parameters>
    <Paging PageSize="25"/>
    <Fetch>
      <Fetch.Url>
        <![CDATA[
					http://svcs.ebay.com/services/search/FindingService/v1
					?OPERATION-NAME=findItemsByKeywords
					&keywords=@Utils.UrlEncode(Model.Query)
					&paginationInput.entriesPerPage=@(Model.PageCursor.NextTake)
					&paginationInput.pageNumber=@(Model.PageCursor.Page+1)
					&GLOBAL-ID=@(Model.GlobalId)
					&RESPONSE-DATA-FORMAT=JSON
					&SECURITY-APPNAME=@(Model.AppId)
					&itemFilter(0).name=MinPrice&itemFilter(0).value=@(Model.MinPrice)
					&itemFilter(0).paramName=Currency&itemFilter(0).paramValue=@(Model.Currency)
					&itemFilter(1).name=MaxPrice&itemFilter(1).value=@(Model.MaxPrice)
					&itemFilter(1).paramName=Currency&itemFilter(1).paramValue=@(Model.Currency)					
					@if(Model.ListingType == true)
					{
						@: &itemFilter(2).name=ListingType&itemFilter(2).value=Auction
					}
					@if(Model.FreeShippingOnly == true && Model.ListingType == true)
					{
						@: &itemFilter(3).name=FreeShippingOnly&itemFilter(3).value=true
					}
					else if(Model.FreeShippingOnly == true && Model.ListingType == false)
					{
						@: &itemFilter(2).name=FreeShippingOnly&itemFilter(2).value=true
					}
					&sortOrder=@(Model.Sorting)
					&outputSelector(0)=SellerInfo
        ]]>
      </Fetch.Url> 
    </Fetch>
    <Parse>
      <JsonPath Expr="$.findItemsByKeywordsResponse[0].searchResult[0].item[*]">
        <JsonPath Expr="itemId[0]" Id="ItemId" Title="Item Id" Converter="String" HelpText=""/>
        <JsonPath Expr="title[0]" Id="Title" Title="Title" Converter="String" HelpText=""/>
        <JsonPath Expr="primaryCategory[0].categoryId[0]" Id="CategoryId" Title="Category Id" Converter="Int" HelpText=""/>
        <JsonPath Expr="primaryCategory[0].categoryName[0]" Id="CategoryName" Title="Category Name" Converter="String" HelpText=""/>
        <JsonPath Expr="viewItemURL[0]" Id="ItemUrl" Title="Item URL" Converter="String" HelpText=""/>
        <JsonPath Expr="galleryURL[0]" Id="GalleryUrl" Title="Gallery URL" Converter="String" HelpText=""/>
        <JsonPath Expr="paymentMethod[0]" Id="PaymentMethod" Title="Payment Method" Converter="String" HelpText=""/>
        <JsonPath Expr="autoPay[0]" Id="AutoPay" Title="AutoPay" Converter="String" HelpText=""/>
        <JsonPath Expr="postalCode[0]" Id="PostalCode" Title="Postal Code" Converter="Int" HelpText="" DefaultValue="0"/>
        <JsonPath Expr="location[0]" Id="Location" Title="Location" Converter="String" HelpText=""/>
        <JsonPath Expr="country[0]" Id="Country" Title="Country" Converter="String" HelpText=""/>
        <JsonPath Expr="sellingStatus[0].sellingState[0]" Id="SellingStatus" Title="SellingStatus" Converter="String" HelpText=""/>
        <JsonPath Expr="sellingStatus[0].bidCount[0]" Id="BidCount" Title="Bid Count" Converter="Int" HelpText="" DefaultValue="0"/>
        <JsonPath Expr="sellingStatus[0].currentPrice[0].__value__" Id="Price" Title="Price" Converter="Double" HelpText=""/>
        <JsonPath Expr="sellingStatus[0].currentPrice[0].@@currencyId" Id="Currency" Title="Currency" Converter="String" HelpText=""/>
        <JsonPath Expr="listingInfo[0].bestOfferEnabled[0]" Id="BestOffer" Title="Best Offer" Converter="String" HelpText=""/>
        <JsonPath Expr="listingInfo[0].buyItNowAvailable[0]" Id="BuyItNow" Title="Buy It Now" Converter="String" HelpText=""/>
        <JsonPath Expr="listingInfo[0].startTime[0]" Id="StartTime" Title="Start Time" Converter="DateTime" HelpText=""/>
        <JsonPath Expr="listingInfo[0].endTime[0]" Id="EndTime" Title="End Time" Converter="DateTime" HelpText=""/>
        <JsonPath Expr="listingInfo[0].listingType[0]" Id="ListingType" Title="Listing Type" Converter="String" HelpText=""/>
        <JsonPath Expr="topRatedListing[0]" Id="TopRatedListing" Title="Top Rated Listing" Converter="String" HelpText=""/>				
        <JsonPath Expr="returnsAccepted[0]" Id="ReturnsAccepted" Title="Returns Accepted" Converter="String" HelpText=""/>
        <JsonPath Expr="sellerInfo[0].sellerUserName[0]" Id="SellerUsername" Title="SellerUsername" Converter="String" HelpText=""/>
        <JsonPath Expr="sellerInfo[0].feedbackScore[0]" Id="SellerFeedbackScore" Title="Seller Feedback Score" Converter="Int" HelpText=""/>
        <JsonPath Expr="sellerInfo[0].positiveFeedbackPercent[0]" Id="PositiveFeedbackRate" Title="Positive Feedback Rate" Converter="Double" HelpText=""/>
      </JsonPath>
        <JsonPath Expr="$.findItemsByKeywordsResponse[0].paginationOutput[0].totalEntries[0]" Id="TotalResults" Title="Total Results" Converter="Long" HelpText=""/>
    </Parse>
    <Fail>
      <JsonPath Expr="$.findItemsByKeywordsResponse[0].errorMessage[0].error[0].message[0]"/>
    </Fail>
  </RestConnector>

	</Suite>